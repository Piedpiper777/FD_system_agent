{% extends "base.html" %}

{% block title %}è®­ç»ƒ - å¼‚å¸¸æ£€æµ‹{% endblock %}

{% block content %}

<style>
:root {
    --anomaly-primary: #F2994A;
    --anomaly-secondary: #FFBF86;
    --anomaly-dark: #D97706;
}
/* é¡µé¢æ•´ä½“æ ·å¼ */
.train-page {
    background: transparent;
    min-height: 100vh;
    padding: 2rem 0 3rem;
}

/* é¡µé¢æ ‡é¢˜åŒºåŸŸ */
.page-header {
    background: transparent;
    color: #495057;
    padding: 0;
    margin-bottom: 2.5rem;
    border: none;
    text-align: center;
    max-width: 760px;
    margin-left: auto;
    margin-right: auto;
}

.page-header h2 {
    font-weight: 700;
    margin-bottom: 0.5rem;
    color: var(--anomaly-primary);
    text-align: center;
}

.page-header p {
    opacity: 0.8;
    margin-bottom: 0;
    color: #6c757d;
    text-align: center;
}

.model-params {
    background-color: #f8f9fa;
    border: 1px solid #dee2e6;
    border-radius: 0.375rem;
    padding: 1rem;
    margin-top: 1rem;
}

.model-params h5 {
    color: #495057;
    margin-bottom: 1rem;
    border-bottom: 2px solid var(--anomaly-primary);
    padding-bottom: 0.5rem;
}

.form-label {
    font-weight: 600;
    color: #495057;
    margin-bottom: 0.75rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.form-label i {
    color: var(--anomaly-primary);
    font-size: 0.9em;
}

.btn-outline-secondary {
    border-color: #6c757d;
    color: #6c757d;
}

.btn-outline-secondary:hover {
    background-color: #6c757d;
    border-color: #6c757d;
    color: white;
}

.btn-primary {
    background-color: var(--anomaly-primary);
    border-color: var(--anomaly-primary);
}

.btn-primary:hover {
    background-color: var(--anomaly-dark);
    border-color: var(--anomaly-dark);
}

/* ç¾åŒ–å¡ç‰‡æ ·å¼ */
.param-card {
    background: white;
    border: 1px solid #dee2e6;
    border-radius: 1rem;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    margin-bottom: 2rem;
    overflow: hidden;
    width: 100%;
    max-width: 1400px;
    margin-left: auto;
    margin-right: auto;
    transition: all 0.3s ease;
}

.param-card:hover {
    box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
    transform: translateY(-2px);
}

.param-card-header {
    background: #f8f9fa;
    color: #495057;
    padding: 1.5rem 2rem;
    margin: 0;
    font-size: 1.1rem;
    font-weight: 600;
    border-bottom: 1px solid #dee2e6;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.param-card-header i {
    font-size: 1.2rem;
    color: var(--anomaly-primary);
}

.param-card-body {
    padding: 2rem;
}

.param-section {
    background: #ffffff;
    border: 1px solid #dee2e6;
    border-radius: 0.75rem;
    padding: 1.75rem;
    margin-bottom: 1.5rem;
    transition: all 0.3s ease;
}

.param-section:hover {
    background: #f8f9fa;
    border-color: var(--anomaly-primary);
    box-shadow: 0 2px 8px rgba(0,0,0,0.05);
    transform: translateY(-1px);
}

.param-subsection {
    border: 1px dashed rgba(242, 153, 74, 0.2);
    border-radius: 0.65rem;
    padding: 1.25rem;
    margin-bottom: 1.25rem;
    background: #ffffff;
    transition: background 0.2s ease;
}

.param-subsection:last-child {
    margin-bottom: 0;
}

.param-subsection-title {
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--anomaly-primary);
    display: flex;
    align-items: center;
    gap: 0.4rem;
    margin-bottom: 0.85rem;
}

.param-subsection-title i {
    color: inherit;
}

.param-section h6 {
    color: #495057;
    font-weight: 600;
    margin-bottom: 1.5rem;
    display: flex;
    align-items: center;
    font-size: 1rem;
    padding-bottom: 0.75rem;
    border-bottom: 2px solid #dee2e6;
}

.param-section h6 i {
    color: var(--anomaly-primary);
    margin-right: 0.5rem;
    font-size: 1em;
}

.param-section.lstm-section h6 i {
    color: var(--anomaly-primary);
}

.param-section.training-section h6 i {
    color: var(--anomaly-primary);
}

.param-section.dataset-section h6 i {
    color: var(--anomaly-primary);
}

/* å‚æ•°è¡Œæ ·å¼ */
.param-row {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 1.5rem;
    margin-bottom: 1.5rem;
    align-items: start;
}

.param-row:last-child {
    margin-bottom: 0;
}

.param-item {
    display: flex;
    flex-direction: column;
}

.param-item.full-width {
    grid-column: 1 / -1;
}

@media (max-width: 768px) {
    .param-row {
        grid-template-columns: 1fr;
        gap: 1rem;
    }
}

/* è¡¨å•æ§ä»¶ç¾åŒ– */
.form-control, .form-select {
    border: 1px solid #ced4da;
    border-radius: 0.375rem;
    padding: 0.625rem 0.875rem;
    font-size: 0.9375rem;
    transition: border-color 0.15s ease-in-out, box-shadow 0.15s ease-in-out;
    background-color: white;
}

.form-control:hover, .form-select:hover {
    border-color: var(--anomaly-primary);
}

.form-control:focus, .form-select:focus {
    border-color: var(--anomaly-primary);
    box-shadow: 0 0 0 0.2rem rgba(242, 153, 74, 0.15);
    outline: none;
}

.form-select-lg {
    padding: 0.75rem 1rem;
    font-size: 1rem;
}

/* æ ‡ç­¾æ ·å¼ */
.form-label {
    font-size: 0.9375rem;
    font-weight: 600;
    color: #495057;
    margin-bottom: 0.75rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 0.5rem;
}

.form-label.align-left {
    justify-content: flex-start;
}

/* å¼‚å¸¸æ£€æµ‹æ¨¡å—è‡ªå®šä¹‰badgeæ ·å¼ï¼Œä¸æ¨¡å—ä¸»è‰²è°ƒä¿æŒä¸€è‡´ */
.badge {
    font-size: 0.75rem;
    padding: 0.35rem 0.65rem;
    border-radius: 0.375rem;
    font-weight: 500;
}

.badge.bg-primary {
    background-color: #F2994A !important;
    color: white;
}

.badge.bg-success {
    background-color: #27AE60 !important;
    color: white;
}

.badge.bg-warning {
    background-color: #F2994A !important;
    color: white;
}

.badge.bg-danger {
    background-color: #EB5757 !important;
    color: white;
}

.form-text {
    font-size: 0.8125rem;
    color: #6c757d;
    margin-top: 0.5rem;
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

/* å¼€å…³æ ·å¼ */
.form-check-input:checked {
    background-color: var(--anomaly-primary);
    border-color: var(--anomaly-primary);
}

/* å¸®åŠ©æ–‡æœ¬ */
.form-text {
    font-size: 0.8rem;
    color: #6c757d;
    margin-top: 0.25rem;
}

/* å“åº”å¼è®¾è®¡ */
@media (max-width: 768px) {
    .param-card {
        width: 100%;
        margin-left: 0;
        margin-right: 0;
    }

    .param-row {
        flex-direction: column;
        gap: 0.75rem;
    }

    .param-card-body {
        padding: 1rem;
    }

    .param-section {
        padding: 1rem;
    }

    .sidebar-toggle {
        z-index: 1002; /* ç¡®ä¿åœ¨ç§»åŠ¨ç«¯æ—¶æŒ‰é’®åœ¨æœ€ä¸Šå±‚ */
    }
}

@media (max-width: 1200px) {
    .param-card {
        width: 100%;
        max-width: none;
    }
}

/* åŠ¨æ€å†…å®¹åˆ‡æ¢åŠ¨ç”» */
.fade-in {
    animation: fadeIn 0.3s ease-in-out;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(10px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

/* æ•°æ®é›†æ¨¡å¼åˆ‡æ¢åŠ¨ç”» */
.dataset-section {
    transition: all 0.3s ease;
    opacity: 1;
    transform: translateY(0);
}

.dataset-section.hiding {
    opacity: 0;
    transform: translateY(-10px);
    pointer-events: none;
}

.dataset-section.showing {
    opacity: 1;
    transform: translateY(0);
}

/* é€‰ä¸­çš„æ•°æ®é›†æ¨¡å¼æ ·å¼ */
.form-check-input:checked + .form-check-label {
    color: var(--anomaly-primary);
    font-weight: 700;
}

/* é”™è¯¯çŠ¶æ€æ ·å¼ */
.is-invalid {
    border-color: #dc3545 !important;
    box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25) !important;
}

.invalid-feedback {
    display: block;
    width: 100%;
    margin-top: 0.25rem;
    font-size: 0.875rem;
    color: #dc3545;
}

/* æ¨¡å¼è¯´æ˜å¡ç‰‡æ‚¬åœæ•ˆæœ */
.alert {
    transition: all 0.2s ease;
}

.alert:hover {
    transform: translateY(-1px);
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
}
</style>

<div class="train-page">
<div class="container-fluid">
<div class="page-header">
    <h2>
        <i class="fas fa-wave-square me-2"></i>
        å¼‚å¸¸æ£€æµ‹æ¨¡å‹è®­ç»ƒ
    </h2>
    <p class="lead mb-0">é…ç½®å¹¶è®­ç»ƒé¢å‘å¼‚å¸¸è¯†åˆ«çš„æ£€æµ‹æ¨¡å‹ï¼Œä½“éªŒä¸RULæ¨¡å—ä¸€è‡´çš„æµç¨‹</p>
</div>
<div id="zeroCodeDiv">
    <form id="zeroCodeForm" novalidate>
        <div class="param-card mb-4">
            <div class="param-card-header">
                <i class="fas fa-robot"></i>
                <span>æ¨¡å‹é€‰æ‹©</span>
            </div>
            <div class="param-card-body">
            <div class="row align-items-end g-3">
                <div class="col-md-8">
                        <label for="modelType" class="form-label align-left">
                            <i class="fas fa-cog"></i>
                        é€‰æ‹©æ¨¡å‹ç±»å‹
                    </label>
                        <select class="form-select form-select-lg" id="modelType" data-action="switch-model-type">
                        <option value="lstm_predictor" selected>ğŸ¯ LSTMé¢„æµ‹å™¨</option>
                            <option value="cnn_1d_autoencoder">ğŸ–¼ï¸ 1D-CNNè‡ªç¼–ç å™¨</option>
                        <option value="lstm_autoencoder">ğŸ“ˆ LSTMè‡ªç¼–ç å™¨</option>
                    </select>
                </div>
                <div class="col-md-4">
                    <button type="button" id="loadDefaultsBtn" class="btn btn-primary w-100 py-3">
                        <i class="fas fa-magic me-2"></i>
                        åŠ è½½é»˜è®¤é…ç½®
                    </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ¨¡å‹è¯´æ˜åŒºåŸŸ -->
        <div id="modelConfig" class="mb-4">
            <div class="param-card">
                <div class="param-card-header">
                    <i class="fas fa-info-circle"></i>
                    <span id="modelConfigTitle">æ¨¡å‹è¯´æ˜</span>
                </div>
                <div class="param-card-body">
                    <!-- åŠ¨æ€æ¨¡å‹é…ç½®å†…å®¹åŒºåŸŸï¼ˆä»…æ˜¾ç¤ºæ¨¡å‹è¯´æ˜ï¼‰ -->
                    <div id="dynamicModelConfig" class="fade-in">
                        <!-- æ¨¡å‹è¯´æ˜å°†åœ¨è¿™é‡ŒåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
            </div>
        </div>

        <!-- å‚æ•°é…ç½®åŒºåŸŸ -->
        <div id="paramConfig" class="mb-4">
            <div class="param-card">
                <div class="param-card-header">
                    <i class="fas fa-cog"></i>
                    <span>å‚æ•°é…ç½®</span>
                </div>
                <div class="param-card-body">
                    <!-- ç½‘ç»œå‚æ•° -->
                    <div class="param-section" id="networkParamsSection">
                        <h6><i class="fas fa-network-wired"></i> ç½‘ç»œå‚æ•°</h6>
                        <div id="networkParamsContent">
                            <div class="alert alert-info mb-3">
                                <small><i class="fas fa-info-circle me-2"></i>è¯·å…ˆé€‰æ‹©æ¨¡å‹ç±»å‹ï¼Œç½‘ç»œå‚æ•°å°†æ ¹æ®æ¨¡å‹ç±»å‹è‡ªåŠ¨æ˜¾ç¤º</small>
                            </div>
                        </div>
                    </div>

                    <!-- ä»»åŠ¡/æ•°æ®å‚æ•° -->
                    <div class="param-section">
                        <h6><i class="fas fa-database"></i> ä»»åŠ¡/æ•°æ®å‚æ•°</h6>
                        <div class="param-row">
                            <div class="param-item">
                                <label class="form-label align-left" id="sequenceLengthLabel">
                                    <i class="fas fa-ruler-horizontal"></i>
                                    <span>åºåˆ—é•¿åº¦</span>
                                </label>
                                <input type="number" class="form-control" id="sequenceLength" name="sequenceLength" value="10" min="1" max="200" aria-label="åºåˆ—é•¿åº¦" title="è¾“å…¥åºåˆ—çš„æ—¶é—´æ­¥é•¿åº¦" data-template-id="lstmSeqLen">
                                <div class="form-text">è¾“å…¥åºåˆ—çš„æ—¶é—´æ­¥é•¿åº¦ï¼Œå½±å“æ¨¡å‹å¯¹æ—¶åºæ¨¡å¼çš„æ•æ‰èƒ½åŠ›</div>
                            </div>
                            <div class="param-item">
                                <label class="form-label align-left" for="stride">
                                    <i class="fas fa-arrows-alt-h"></i>
                                    <span>æ•°æ®æ­¥é•¿</span>
                                </label>
                                <input type="number" class="form-control" id="stride" name="stride" value="1" min="1" max="10" aria-label="æ•°æ®æ­¥é•¿" title="æ»‘åŠ¨çª—å£æ­¥é•¿" data-template-id="lstmPredStride">
                                <div class="form-text">åˆ›å»ºè®­ç»ƒåºåˆ—æ—¶çš„æ»‘åŠ¨çª—å£æ­¥é•¿ï¼Œå½±å“è®­ç»ƒæ•°æ®é‡</div>
                            </div>
                        </div>
                        <!-- é¢„æµ‹é•¿åº¦å’Œè¾“å…¥ç»´åº¦å‡ç”±ç³»ç»Ÿè‡ªåŠ¨ç®¡ç†ï¼Œæ— éœ€é¢å¤–è¾“å…¥ -->
                    </div>

                    <!-- ä¼˜åŒ–å™¨è®¾ç½® -->
                    <div class="param-section">
                        <h6><i class="fas fa-tachometer-alt"></i> ä¼˜åŒ–å™¨è®¾ç½®</h6>
                        <div class="param-row">
                            <div class="param-item">
                                <label class="form-label">
                                    å­¦ä¹ ç‡
                                </label>
                                <input type="number" class="form-control" id="learningRate" name="learningRate" value="0.001" step="0.0001" min="0.00001" max="0.1" aria-label="å­¦ä¹ ç‡" title="å­¦ä¹ ç‡">
                                <div class="form-text">Adamä¼˜åŒ–å™¨çš„å­¦ä¹ ç‡ï¼Œé€šå¸¸åœ¨0.0001-0.01ä¹‹é—´</div>
                            </div>
                            <div class="param-item">
                                <label class="form-label">
                                    æƒé‡è¡°å‡ (L2æ­£åˆ™åŒ–)
                                </label>
                                <input type="number" class="form-control" id="weightDecay" name="weightDecay" value="0.0001" step="0.00001" min="0" max="0.01" aria-label="æƒé‡è¡°å‡" title="æƒé‡è¡°å‡">
                                <div class="form-text">L2æ­£åˆ™åŒ–ç³»æ•°ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆ</div>
                            </div>
                        </div>
                    </div>

                    <!-- è®­ç»ƒæ§åˆ¶ -->
                    <div class="param-section">
                        <h6><i class="fas fa-cogs"></i> è®­ç»ƒæ§åˆ¶</h6>
                        <div class="param-row">
                            <div class="param-item">
                                <label class="form-label">
                                    è®­ç»ƒè½®æ•°
                                </label>
                                <input type="number" class="form-control" id="numEpochs" name="numEpochs" value="50" min="1" max="500" aria-label="è®­ç»ƒè½®æ¬¡" title="è®­ç»ƒè½®æ¬¡">
                                <div class="form-text">æœ€å¤§è®­ç»ƒè½®æ•°</div>
                            </div>
                            <div class="param-item">
                                <label class="form-label">
                                    æ‰¹æ¬¡å¤§å°
                                </label>
                                <input type="number" class="form-control" id="batchSize" name="batchSize" value="32" min="1" max="512" step="8" aria-label="æ‰¹æ¬¡å¤§å°" title="æ‰¹æ¬¡å¤§å°">
                                <div class="form-text">è®­ç»ƒæ‰¹æ¬¡å¤§å°ï¼Œå½±å“å†…å­˜ä½¿ç”¨å’Œè®­ç»ƒé€Ÿåº¦</div>
                            </div>
                        </div>
                        <div class="param-row">
                            <div class="param-item">
                                <label class="form-label">
                                    æ—©åœè€å¿ƒå€¼
                                </label>
                                <input type="number" class="form-control" id="patience" name="patience" value="10" min="1" max="50" aria-label="æ—©åœè€å¿ƒ" title="æ—©åœè€å¿ƒ">
                                <div class="form-text">éªŒè¯æŸå¤±å¤šå°‘è½®ä¸ä¸‹é™åˆ™æ—©åœï¼Œ0è¡¨ç¤ºä¸å¯ç”¨æ—©åœ</div>
                            </div>
                            <div class="param-item">
                                <label class="form-label">
                                    æ¢¯åº¦è£å‰ªèŒƒæ•°
                                </label>
                                <input type="number" class="form-control" id="clipGradNorm" name="clipGradNorm" value="5.0" step="0.1" min="0" max="20" aria-label="æ¢¯åº¦è£å‰ªèŒƒæ•°" title="æ¢¯åº¦è£å‰ªèŒƒæ•°">
                                <div class="form-text">æ¢¯åº¦è£å‰ªçš„æœ€å¤§èŒƒæ•°ï¼Œé˜²æ­¢æ¢¯åº¦çˆ†ç‚¸</div>
                            </div>
                        </div>
                        <div class="param-row">
                            <div class="param-item">
                                <label class="form-label">
                                    éšæœºç§å­
                                </label>
                                <input type="number" class="form-control" id="randomSeed" name="randomSeed" value="42" min="0" max="999999" aria-label="éšæœºç§å­" title="éšæœºç§å­">
                                <div class="form-text">éšæœºç§å­ï¼Œç¡®ä¿å®éªŒå¯é‡ç°</div>
                            </div>
                            <div class="param-item">
                                <label class="form-label">
                                    è®¡ç®—è®¾å¤‡
                                </label>
                                <select class="form-select" id="device" name="device" aria-label="è®¡ç®—è®¾å¤‡" title="è®¡ç®—è®¾å¤‡">
                                    <option value="CPU">CPU</option>
                                    <option value="GPU" selected>GPU</option>
                                    <option value="Ascend">æ˜‡è…¾ (Ascend)</option>
                                </select>
                                <div class="form-text">è®­ç»ƒä½¿ç”¨çš„è®¡ç®—è®¾å¤‡ï¼Œå¯é€‰æ‹©CPU / GPU / æ˜‡è…¾</div>
                            </div>
                        </div>
                    </div>

                    <!-- é˜ˆå€¼è®¡ç®—é…ç½®ï¼ˆä»…å¼‚å¸¸æ£€æµ‹ï¼‰ -->
                    <div class="param-section">
                        <h6><i class="fas fa-chart-line"></i> é˜ˆå€¼è®¡ç®—é…ç½®</h6>
                        <div class="alert alert-info">
                            <i class="fas fa-info-circle"></i> è®­ç»ƒå®Œæˆåå°†ä½¿ç”¨éªŒè¯é›†è‡ªåŠ¨è®¡ç®—å¼‚å¸¸æ£€æµ‹é˜ˆå€¼
                        </div>
                        <div class="param-row">
                            <div class="param-item">
                                <label class="form-label">
                                    é˜ˆå€¼è®¡ç®—æ–¹æ³•
                                </label>
                                <select class="form-select" id="thresholdMethod" name="thresholdMethod">
                                    <option value="percentile" selected>ç™¾åˆ†ä½æ•° (Percentile)</option>
                                    <option value="3sigma">3å€æ ‡å‡†å·® (3-Sigma)</option>
                                    <option value="contamination">æ±¡æŸ“ç‡ (Contamination)</option>
                                </select>
                                <div class="form-text">é€‰æ‹©è®¡ç®—å¼‚å¸¸é˜ˆå€¼çš„æ–¹æ³•</div>
                            </div>
                            <div class="param-item" id="thresholdPercentileConfig">
                                <label class="form-label">
                                    ç™¾åˆ†ä½æ•°å€¼
                                </label>
                                <input type="number" class="form-control" id="thresholdPercentile" name="thresholdPercentile" value="95" min="90" max="99.9" step="0.1">
                                <div class="form-text">å¼‚å¸¸åˆ†æ•°çš„ç™¾åˆ†ä½æ•°é˜ˆå€¼ï¼Œå€¼è¶Šå¤§è¶Šä¸¥æ ¼ï¼ˆ90-99.9ï¼‰</div>
                            </div>
                        </div>
                        <div class="param-row" id="thresholdContaminationConfig" style="display: none;">
                            <div class="param-item">
                                <label class="form-label">
                                    æ±¡æŸ“ç‡
                                </label>
                                <input type="number" class="form-control" id="thresholdContamination" name="thresholdContamination" value="0.01" min="0.001" max="0.1" step="0.001">
                                <div class="form-text">é¢„æœŸå¼‚å¸¸æ ·æœ¬çš„æ¯”ä¾‹ï¼ˆ0.001-0.1ï¼‰</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- éšè—çš„æ¨¡æ¿åŒºåŸŸ -->
        <div style="display: none;">
            <!-- LSTM Predictor å‚æ•°æ¨¡æ¿ -->
            <div id="lstmPredictorTemplate" class="model-config-template">
                <!-- 1. ç½‘ç»œå‚æ•°ï¼ˆLSTMç»“æ„ç›¸å…³ï¼‰ -->
                <div class="param-section lstm-section">
                    <h6><i class="fas fa-network-wired"></i> ç½‘ç»œå‚æ•°</h6>
                    <div class="param-row">
                        <div class="param-item">
                            <label class="form-label">
                                éšè—ç»´åº¦
                            </label>
                            <input type="number" class="form-control" id="lstmPredHiddenDim" name="lstmPredHiddenDim" value="64" min="16" max="512" step="16" aria-label="LSTMéšè—ç»´åº¦" title="LSTMéšè—ç»´åº¦">
                            <div class="form-text">LSTMéšè—å±‚çš„ç»´åº¦å¤§å°ï¼Œå½±å“æ¨¡å‹å®¹é‡</div>
                        </div>
                        <div class="param-item">
                            <label class="form-label">
                                LSTMå±‚æ•°
                            </label>
                            <input type="number" class="form-control" id="lstmPredNumLayers" name="lstmPredNumLayers" value="2" min="1" max="5" aria-label="LSTMå±‚æ•°" title="LSTMå±‚æ•°">
                            <div class="form-text">LSTMç½‘ç»œçš„å±‚æ•°ï¼Œå±‚æ•°è¶Šå¤šè¡¨è¾¾èƒ½åŠ›è¶Šå¼º</div>
                        </div>
                    </div>
                    <div class="param-row">
                        <div class="param-item">
                            <label class="form-label">
                                LSTM Dropout
                            </label>
                            <input type="number" class="form-control" id="lstmPredDropout" name="lstmPredDropout" value="0.1" step="0.1" min="0" max="0.9" aria-label="LSTM Dropoutç‡" title="LSTM Dropoutç‡">
                            <div class="form-text">LSTMå±‚é—´çš„dropoutæ¯”ä¾‹ï¼Œé˜²æ­¢è¿‡æ‹Ÿåˆ</div>
                        </div>
                        <div class="param-item">
                            <label class="form-label">
                                LSTMæ¿€æ´»å‡½æ•°
                            </label>
                            <select class="form-select" id="lstmPredActivation" name="lstmPredActivation" aria-label="LSTMæ¿€æ´»å‡½æ•°" title="LSTMæ¿€æ´»å‡½æ•°">
                                <option value="tanh" selected>Tanh</option>
                                <option value="relu">ReLU</option>
                                <option value="sigmoid">Sigmoid</option>
                            </select>
                            <div class="form-text">LSTMå†…éƒ¨ä½¿ç”¨çš„æ¿€æ´»å‡½æ•°</div>
                        </div>
                    </div>
                    <div class="param-row">
                        <div class="param-item">
                            <label class="form-label">
                                åŒå‘LSTM
                            </label>
                            <select class="form-select" id="lstmPredBidirectional" name="lstmPredBidirectional" aria-label="åŒå‘LSTM" title="åŒå‘LSTM">
                                <option value="false" selected>å¦</option>
                                <option value="true">æ˜¯</option>
                            </select>
                            <div class="form-text">åŒå‘LSTMå¯ä»¥æ•æ‰æ­£åå‘æ—¶åºä¿¡æ¯ï¼Œæå‡æ€§èƒ½ä½†å¢åŠ è®¡ç®—é‡</div>
                        </div>
                        <div class="param-item">
                            <label class="form-label">
                                å±‚å½’ä¸€åŒ– (Layer Normalization)
                            </label>
                            <select class="form-select" id="lstmPredLayerNorm" name="lstmPredLayerNorm" aria-label="å±‚å½’ä¸€åŒ–" title="å±‚å½’ä¸€åŒ–">
                                <option value="false" selected>å¦</option>
                                <option value="true">æ˜¯</option>
                            </select>
                            <div class="form-text">åœ¨LSTMå±‚ååº”ç”¨å±‚å½’ä¸€åŒ–ï¼Œå¯ä»¥ç¨³å®šè®­ç»ƒå¹¶æå‡æ€§èƒ½</div>
                        </div>
                    </div>
                </div>
                
            </div>
            
            <!-- 1D CNN Autoencoder å‚æ•°æ¨¡æ¿ -->
            <div id="cnn1dAutoencoderTemplate" class="model-config-template">
                <div class="param-section">
                    <h6><i class="fas fa-wave-square"></i> å·ç§¯è‡ªç¼–ç å™¨å‚æ•°</h6>

                    <div class="param-subsection">
                        <div class="param-subsection-title">
                            <i class="fas fa-layer-group"></i>
                            å·ç§¯å †æ ˆ
                        </div>
                        <div class="param-row">
                            <div class="param-item">
                                <label class="form-label">
                                    å·ç§¯é€šé“é…ç½®
                                </label>
                                <input type="text" class="form-control" id="convChannels" name="convChannels" value="64,128,256" placeholder="64,128,256" aria-label="å·ç§¯é€šé“é…ç½®">
                                <div class="form-text">é€—å·åˆ†éš”æ•´æ•°ï¼Œæ¡ç›®æ•°å³å·ç§¯å±‚æ•°ï¼›è‡ªç¼–ç å™¨çš„ç¼–ç /è§£ç éƒ¨åˆ†ä¼šè‡ªåŠ¨é•œåƒè¯¥é…ç½®</div>
                            </div>
                            <div class="param-item">
                                <label class="form-label">
                                    å·ç§¯æ ¸å¤§å°
                                </label>
                                <input type="text" class="form-control" id="kernelSizes" name="kernelSizes" value="7,5,3" placeholder="7,5,3" aria-label="å·ç§¯æ ¸å¤§å°">
                                <div class="form-text">ä¸å·ç§¯å±‚ä¸€ä¸€å¯¹åº”ï¼Œå»ºè®®é€å±‚å‡å°ä»¥æ•æ‰å¤šå°ºåº¦æ¨¡å¼</div>
                            </div>
                        </div>
                    </div>

                    <div class="param-subsection">
                        <div class="param-subsection-title">
                            <i class="fas fa-compress-alt"></i>
                            æ½œåœ¨ç©ºé—´/é‡æ„
                        </div>
                        <div class="param-row">
                            <div class="param-item">
                                <label class="form-label">
                                    ç“¶é¢ˆå±‚ç»´åº¦
                                </label>
                                <input type="number" class="form-control" id="cnnBottleneckDim" name="cnnBottleneckDim" value="64" min="16" max="256" step="8" aria-label="ç“¶é¢ˆå±‚ç»´åº¦">
                                <div class="form-text">å†³å®šæ½œåœ¨ç©ºé—´å‹ç¼©ç¨‹åº¦ï¼Œè¶Šå°é‡æ„è¶Šéš¾ä½†å¯¹å¼‚å¸¸æ›´æ•æ„Ÿ</div>
                            </div>
                            <div class="param-item">
                                <div class="form-text text-muted" style="margin-top: 2.6rem;">
                                    å·ç§¯å±‚æ•°å’Œé€šé“å°†åœ¨è§£ç å™¨ä¸­è‡ªåŠ¨ç¿»è½¬ï¼Œæ— éœ€é¢å¤–é…ç½®
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="param-subsection">
                        <div class="param-subsection-title">
                            <i class="fas fa-shield-alt"></i>
                            æ­£åˆ™åŒ–ä¸æ¿€æ´»
                        </div>
                        <div class="param-row">
                            <div class="param-item">
                                <label class="form-label">
                                    Dropoutç‡
                                </label>
                                <input type="number" class="form-control" id="dropout" name="dropout" value="0.1" step="0.05" min="0" max="0.5" aria-label="Dropoutç‡">
                                <div class="form-text">å·ç§¯å—ä¸è§£ç å™¨å…±äº«çš„Dropoutï¼Œå»ºè®®ä¿æŒè¾ƒä½ä»¥ä¿æŠ¤é‡æ„èƒ½åŠ›</div>
                            </div>
                            <div class="param-item">
                                <label class="form-label">
                                    æ¿€æ´»å‡½æ•°
                                </label>
                                <select class="form-select" id="activation" name="activation" aria-label="æ¿€æ´»å‡½æ•°">
                                    <option value="relu" selected>ReLU</option>
                                    <option value="leakyrelu">LeakyReLU</option>
                                    <option value="gelu">GELU</option>
                                    <option value="tanh">Tanh</option>
                                    <option value="sigmoid">Sigmoid</option>
                                </select>
                                <div class="form-text">ç¼–ç å™¨ä¸è§£ç å™¨å¤ç”¨åŒä¸€æ¿€æ´»å‡½æ•°ï¼Œæ–¹ä¾¿ä¸RUL CNNä¿æŒä¸€è‡´ä½“éªŒ</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- LSTM Autoencoder å‚æ•°æ¨¡æ¿ -->
            <div id="lstmAutoencoderTemplate" class="model-config-template">
                <div class="param-section lstm-ae-section">
                    <h6><i class="fas fa-code-branch"></i> ç¼–ç å™¨-è§£ç å™¨ç½‘ç»œå‚æ•°</h6>
                    <div class="param-row">
                        <div class="param-item">
                            <label class="form-label">
                                éšè—å±‚ç»´åº¦
                            </label>
                            <input type="number" class="form-control" id="lstmAeHiddenSize" name="lstmAeHiddenSize" value="128" min="32" max="512" step="16" aria-label="LSTMéšè—å±‚ç»´åº¦" title="LSTMéšè—å±‚ç»´åº¦">
                            <div class="form-text">ç¼–ç å™¨å’Œè§£ç å™¨LSTMçš„éšè—å±‚ç»´åº¦ï¼Œå½±å“æ¨¡å‹è¡¨è¾¾èƒ½åŠ›</div>
                        </div>
                        <div class="param-item">
                            <label class="form-label">
                                ç“¶é¢ˆå±‚ç»´åº¦
                            </label>
                            <input type="number" class="form-control" id="lstmAeBottleneckDim" name="lstmAeBottleneckDim" value="64" min="16" max="256" step="8" aria-label="ç“¶é¢ˆå±‚ç»´åº¦" title="ç“¶é¢ˆå±‚ç»´åº¦">
                            <div class="form-text">ç“¶é¢ˆå±‚ç»´åº¦ï¼Œæ§åˆ¶ä¿¡æ¯å‹ç¼©ç¨‹åº¦ï¼Œå½±å“é‡æ„è´¨é‡</div>
                        </div>
                    </div>
                    <div class="param-row">
                        <div class="param-item">
                            <label class="form-label">
                                LSTMå±‚æ•°
                            </label>
                            <input type="number" class="form-control" id="lstmAeNumLayers" name="lstmAeNumLayers" value="2" min="1" max="4" aria-label="LSTMå±‚æ•°" title="LSTMå±‚æ•°">
                            <div class="form-text">ç¼–ç å™¨å’Œè§£ç å™¨çš„LSTMå±‚æ•°ï¼Œå±‚æ•°è¶Šå¤šè¡¨è¾¾èƒ½åŠ›è¶Šå¼º</div>
                        </div>
                        <div class="param-item">
                            <label class="form-label">
                                Dropoutç‡
                            </label>
                            <input type="number" class="form-control" id="lstmAeDropout" name="lstmAeDropout" value="0.1" step="0.05" min="0" max="0.5" aria-label="Dropoutç‡" title="Dropoutç‡">
                            <div class="form-text">é˜²æ­¢è¿‡æ‹Ÿåˆçš„Dropoutæ¯”ä¾‹ï¼Œå»ºè®®ä¿æŒè¾ƒä½å€¼</div>
                        </div>
                    </div>
                </div>
            </div>

        </div>


        <!-- æ•°æ®é›†é…ç½®åŒºåŸŸ -->
        <div id="datasetConfig" class="mb-4">
            <div class="param-card">
                <div class="param-card-header">
                    <i class="fas fa-database"></i>
                    <span>æ•°æ®é›†é…ç½®</span>
                </div>
                <div class="param-card-body">
                    <!-- LSTMé¢„æµ‹æ¨¡å‹ä¸“ç”¨æ•°æ®é›†é…ç½® -->
                    <div id="lstmPredictorDatasetConfig" style="display: none;">
                        <div class="alert alert-info mb-4">
                            <h6><i class="fas fa-info-circle"></i> LSTMé¢„æµ‹æ¨¡å‹æ•°æ®é›†è¯´æ˜</h6>
                            <p class="mb-2">LSTMé¢„æµ‹æ¨¡å‹åŸºäºé¢„æµ‹è¯¯å·®è¿›è¡Œå¼‚å¸¸æ£€æµ‹ï¼Œé‡‡ç”¨æ— ç›‘ç£å­¦ä¹ ï¼Œåªéœ€è¦æ— æ ‡ç­¾çš„è®­ç»ƒæ•°æ®ã€‚</p>
                            <p class="mb-0">ç³»ç»Ÿå°†ä»è®­ç»ƒæ•°æ®ä¸­è‡ªåŠ¨åˆ’åˆ†éªŒè¯é›†ï¼Œæ— éœ€æ‰‹åŠ¨ä¸Šä¼ å¤šä¸ªæ–‡ä»¶ã€‚</p>
                            <p class="mb-0 mt-2">
                                <small class="text-muted">
                                    éœ€è¦å¯¹åŸå§‹æ•°æ®åšæ¸…æ´—ã€å¯¹é½æˆ–å½’ä¸€åŒ–ï¼Ÿè¯·å…ˆå‰å¾€
                                    <a href="{{ url_for('data_management.index') }}" class="text-decoration-none fw-bold">æ•°æ®ç®¡ç†æ¨¡å—</a>
                                    å®Œæˆæ“ä½œï¼Œå†è¿”å›è®­ç»ƒé¡µé¢é€‰æ‹©é¢„å¤„ç†åçš„æ–‡ä»¶ã€‚
                                </small>
                            </p>
                        </div>

                        <!-- å·¥å†µé€‰æ‹©åŒºåŸŸ -->
                        <div class="param-section dataset-section">
                            <h6><i class="fas fa-filter"></i> å·¥å†µç­›é€‰</h6>
                            <div class="alert alert-info mb-3">
                                <small>
                                    <i class="fas fa-info-circle me-2"></i>
                                    é€‰æ‹©å·¥å†µæ¡ä»¶æ¥ç­›é€‰æ•°æ®æ–‡ä»¶ã€‚è®­ç»ƒé›†å°†è‡ªåŠ¨ç­›é€‰æ ‡ç­¾ä¸º"æ­£å¸¸"çš„æ–‡ä»¶ã€‚
                                </small>
                                    </div>
                            <div id="conditionSelectionAreaPredictor">
                                <div class="text-center py-3">
                                    <div class="spinner-border spinner-border-sm text-primary"></div>
                                    <span class="ms-2 text-muted">åŠ è½½å·¥å†µé€‰é¡¹...</span>
                                </div>
                            </div>
                        </div>

                        <!-- è®­ç»ƒé›†æ–‡ä»¶é€‰æ‹©åŒºåŸŸ -->
                        <div class="param-section dataset-section mt-4" id="trainFileSelectionAreaPredictor" style="display: none;">
                            <h6><i class="fas fa-folder-open"></i> è®­ç»ƒé›†æ–‡ä»¶é€‰æ‹©</h6>
                            <div class="alert alert-success mb-3">
                                <small>
                                    <i class="fas fa-check-circle me-2"></i>
                                    å·²ç­›é€‰å‡º <span id="trainFileCountPredictor">0</span> ä¸ªç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶ï¼ˆæ ‡ç­¾=æ­£å¸¸ï¼‰
                                </small>
                            </div>
                            <div id="trainFileListPredictor" style="max-height: 300px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 0.375rem; padding: 1rem;">
                                <div class="text-muted text-center py-3">è¯·å…ˆé€‰æ‹©å·¥å†µæ¡ä»¶</div>
                            </div>
                            <div class="mt-2">
                                <button type="button" class="btn btn-sm btn-outline-primary" onclick="selectAllTrainFilesPredictor()">
                                    <i class="fas fa-check-square me-1"></i>å…¨é€‰
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-secondary ms-2" onclick="deselectAllTrainFilesPredictor()">
                                    <i class="fas fa-square me-1"></i>å–æ¶ˆå…¨é€‰
                                </button>
                            </div>
                        </div>

                        <div class="param-section dataset-section mt-4">
                            <h6><i class="fas fa-chart-pie"></i> æ•°æ®åˆ’åˆ†è®¾ç½®</h6>
                            <div class="param-row">
                                <div class="param-item">
                                    <label class="form-label" for="predictorValSplit">
                                        <i class="fas fa-percentage"></i>
                                        <span>éªŒè¯é›†æ¯”ä¾‹</span>
                                    </label>
                                    <input type="number"
                                           class="form-control"
                                           id="predictorValSplit"
                                           name="predictorValSplit"
                                           value="0.2"
                                           min="0.1"
                                           max="0.5"
                                           step="0.05"
                                           aria-label="éªŒè¯é›†æ¯”ä¾‹">
                                    <div class="form-text">ä»è®­ç»ƒæ•°æ®ä¸­åˆ’åˆ†çš„éªŒè¯é›†æ¯”ä¾‹</div>
                                </div>
                            </div>
                            <div class="alert alert-light border">
                                <small>
                                    <i class="fas fa-lightbulb text-warning me-2"></i>
                                    æ— ç›‘ç£å­¦ä¹ æ¨¡å¼ï¼šè®­ç»ƒé›†ç”¨äºå­¦ä¹ é¢„æµ‹æ¨¡å¼ï¼ŒéªŒè¯é›†ç”¨äºè°ƒå‚å’Œæ—©åœ
                                </small>
                            </div>
                        </div>

                        <!-- æµ‹è¯•é›†æ–‡ä»¶é€‰æ‹©åŒºåŸŸ -->
                        <div class="param-section dataset-section mt-4" id="testFileSelectionAreaPredictor" style="display: none;">
                            <h6><i class="fas fa-flask"></i> æµ‹è¯•é›†é…ç½®ï¼ˆå¯é€‰ï¼‰</h6>
                            <div class="alert alert-warning mb-3">
                                <small>
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    æµ‹è¯•é›†å°†ç­›é€‰æ ‡ç­¾ä¸º"æ­£å¸¸"æˆ–"å¼‚å¸¸"çš„æ–‡ä»¶
                                </small>
                            </div>
                            <div id="testFileListPredictor" style="max-height: 300px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 0.375rem; padding: 1rem;">
                                <div class="text-muted text-center py-3">è¯·å…ˆé€‰æ‹©å·¥å†µæ¡ä»¶</div>
                            </div>
                            <div class="mt-2">
                                <button type="button" class="btn btn-sm btn-outline-primary" onclick="selectAllTestFilesPredictor()">
                                    <i class="fas fa-check-square me-1"></i>å…¨é€‰
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-secondary ms-2" onclick="deselectAllTestFilesPredictor()">
                                    <i class="fas fa-square me-1"></i>å–æ¶ˆå…¨é€‰
                                </button>
                            </div>
                            <div class="alert alert-info border mt-3">
                                <small>
                                    <i class="fas fa-info-circle text-info me-2"></i>
                                    <strong>è¯„ä¼°è¯´æ˜ï¼š</strong>å¦‚æœæä¾›æµ‹è¯•é›†ï¼Œè®­ç»ƒå®Œæˆåå°†è‡ªåŠ¨è¯„ä¼°æ¨¡å‹æ€§èƒ½ï¼Œå¹¶è®¡ç®—å¼‚å¸¸æ£€æµ‹æŒ‡æ ‡ï¼ˆé‡æ„è¯¯å·®åˆ†å¸ƒã€å¼‚å¸¸åˆ†æ•°ç»Ÿè®¡ç­‰ï¼‰
                                </small>
                            </div>
                        </div>
                    </div>

                    <!-- LSTM Autoencoderä¸“ç”¨æ•°æ®é›†é…ç½® -->
                    <div id="lstmAutoencoderDatasetConfig" style="display: none;">
                        <div class="alert alert-info mb-4">
                            <h6><i class="fas fa-info-circle"></i> LSTM Autoencoderæ•°æ®é›†è¯´æ˜</h6>
                            <p class="mb-2">LSTM AutoencoderåŸºäºé‡æ„è¯¯å·®è¿›è¡Œå¼‚å¸¸æ£€æµ‹ï¼Œé‡‡ç”¨æ— ç›‘ç£å­¦ä¹ ï¼Œåªéœ€è¦æ— æ ‡ç­¾çš„è®­ç»ƒæ•°æ®ã€‚</p>
                            <p class="mb-0">ç³»ç»Ÿå°†ä»è®­ç»ƒæ•°æ®ä¸­è‡ªåŠ¨åˆ’åˆ†éªŒè¯é›†ï¼Œæ— éœ€æ‰‹åŠ¨ä¸Šä¼ å¤šä¸ªæ–‡ä»¶ã€‚</p>
                            <p class="mb-0 mt-2">
                                <small class="text-muted">
                                    éœ€è¦å¯¹åŸå§‹æ•°æ®åšæ¸…æ´—ã€å¯¹é½æˆ–å½’ä¸€åŒ–ï¼Ÿè¯·å…ˆå‰å¾€
                                    <a href="{{ url_for('data_management.index') }}" class="text-decoration-none fw-bold">æ•°æ®ç®¡ç†æ¨¡å—</a>
                                    å®Œæˆæ“ä½œï¼Œå†è¿”å›è®­ç»ƒé¡µé¢é€‰æ‹©é¢„å¤„ç†åçš„æ–‡ä»¶ã€‚
                                </small>
                            </p>
                        </div>

                        <!-- å·¥å†µé€‰æ‹©åŒºåŸŸ -->
                        <div class="param-section dataset-section">
                            <h6><i class="fas fa-filter"></i> å·¥å†µç­›é€‰</h6>
                            <div class="alert alert-info mb-3">
                                <small>
                                    <i class="fas fa-info-circle me-2"></i>
                                    é€‰æ‹©å·¥å†µæ¡ä»¶æ¥ç­›é€‰æ•°æ®æ–‡ä»¶ã€‚è®­ç»ƒé›†å°†è‡ªåŠ¨ç­›é€‰æ ‡ç­¾ä¸º"æ­£å¸¸"çš„æ–‡ä»¶ã€‚
                                </small>
                                    </div>
                            <div id="conditionSelectionArea">
                                <div class="text-center py-3">
                                    <div class="spinner-border spinner-border-sm text-primary"></div>
                                    <span class="ms-2 text-muted">åŠ è½½å·¥å†µé€‰é¡¹...</span>
                                </div>
                            </div>
                        </div>

                        <!-- è®­ç»ƒé›†æ–‡ä»¶é€‰æ‹©åŒºåŸŸ -->
                        <div class="param-section dataset-section mt-4" id="trainFileSelectionArea" style="display: none;">
                            <h6><i class="fas fa-folder-open"></i> è®­ç»ƒé›†æ–‡ä»¶é€‰æ‹©</h6>
                            <div class="alert alert-success mb-3">
                                <small>
                                    <i class="fas fa-check-circle me-2"></i>
                                    å·²ç­›é€‰å‡º <span id="trainFileCount">0</span> ä¸ªç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶ï¼ˆæ ‡ç­¾=æ­£å¸¸ï¼‰
                                </small>
                            </div>
                            <div id="trainFileList" style="max-height: 300px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 0.375rem; padding: 1rem;">
                                <div class="text-muted text-center py-3">è¯·å…ˆé€‰æ‹©å·¥å†µæ¡ä»¶</div>
                            </div>
                            <div class="mt-2">
                                <button type="button" class="btn btn-sm btn-outline-primary" onclick="selectAllTrainFiles()">
                                    <i class="fas fa-check-square me-1"></i>å…¨é€‰
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-secondary ms-2" onclick="deselectAllTrainFiles()">
                                    <i class="fas fa-square me-1"></i>å–æ¶ˆå…¨é€‰
                                </button>
                            </div>
                        </div>

                        <div class="param-section dataset-section mt-4">
                            <h6><i class="fas fa-chart-pie"></i> æ•°æ®åˆ’åˆ†è®¾ç½®</h6>
                            <div class="param-row">
                                <div class="param-item">
                                    <label class="form-label" for="autoencoderValSplit">
                                        <i class="fas fa-percentage"></i>
                                        <span>éªŒè¯é›†æ¯”ä¾‹</span>
                                    </label>
                                    <input type="number"
                                           class="form-control"
                                           id="autoencoderValSplit"
                                           name="autoencoderValSplit"
                                           value="0.2"
                                           min="0.1"
                                           max="0.5"
                                           step="0.05"
                                           aria-label="éªŒè¯é›†æ¯”ä¾‹">
                                    <div class="form-text">ä»è®­ç»ƒæ•°æ®ä¸­åˆ’åˆ†çš„éªŒè¯é›†æ¯”ä¾‹</div>
                                </div>
                            </div>
                            <div class="alert alert-light border">
                                <small>
                                    <i class="fas fa-lightbulb text-warning me-2"></i>
                                    æ— ç›‘ç£å­¦ä¹ æ¨¡å¼ï¼šè®­ç»ƒé›†ç”¨äºå­¦ä¹ æ­£å¸¸æ¨¡å¼ï¼ŒéªŒè¯é›†ç”¨äºè°ƒå‚å’Œæ—©åœ
                                </small>
                            </div>
                        </div>

                        <!-- æµ‹è¯•é›†æ–‡ä»¶é€‰æ‹©åŒºåŸŸ -->
                        <div class="param-section dataset-section mt-4" id="testFileSelectionArea" style="display: none;">
                            <h6><i class="fas fa-flask"></i> æµ‹è¯•é›†é…ç½®ï¼ˆå¯é€‰ï¼‰</h6>
                            <div class="alert alert-warning mb-3">
                                <small>
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    æµ‹è¯•é›†å°†ç­›é€‰æ ‡ç­¾ä¸º"æ­£å¸¸"æˆ–"å¼‚å¸¸"çš„æ–‡ä»¶
                                </small>
                            </div>
                            <div id="testFileList" style="max-height: 300px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 0.375rem; padding: 1rem;">
                                <div class="text-muted text-center py-3">è¯·å…ˆé€‰æ‹©å·¥å†µæ¡ä»¶</div>
                            </div>
                            <div class="mt-2">
                                <button type="button" class="btn btn-sm btn-outline-primary" onclick="selectAllTestFiles()">
                                    <i class="fas fa-check-square me-1"></i>å…¨é€‰
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-secondary ms-2" onclick="deselectAllTestFiles()">
                                    <i class="fas fa-square me-1"></i>å–æ¶ˆå…¨é€‰
                                </button>
                            </div>
                            <div class="alert alert-info border mt-3">
                                <small>
                                    <i class="fas fa-info-circle text-info me-2"></i>
                                    <strong>è¯„ä¼°è¯´æ˜ï¼š</strong>å¦‚æœæä¾›æµ‹è¯•é›†ï¼Œè®­ç»ƒå®Œæˆåå°†è‡ªåŠ¨è¯„ä¼°æ¨¡å‹æ€§èƒ½ï¼Œå¹¶è®¡ç®—å¼‚å¸¸æ£€æµ‹æŒ‡æ ‡ï¼ˆé‡æ„è¯¯å·®åˆ†å¸ƒã€å¼‚å¸¸åˆ†æ•°ç»Ÿè®¡ç­‰ï¼‰
                                </small>
                            </div>
                        </div>
                    </div>

                    <!-- CNN 1D Autoencoderä¸“ç”¨æ•°æ®é›†é…ç½® -->
                    <div id="cnn1dAutoencoderDatasetConfig" style="display: none;">
                        <div class="alert alert-info mb-4">
                            <h6><i class="fas fa-info-circle"></i> 1D CNN Autoencoderæ•°æ®é›†è¯´æ˜</h6>
                            <p class="mb-2">1D CNN AutoencoderåŸºäºé‡æ„è¯¯å·®è¿›è¡Œå¼‚å¸¸æ£€æµ‹ï¼Œé‡‡ç”¨æ— ç›‘ç£å­¦ä¹ ï¼Œåªéœ€è¦æ— æ ‡ç­¾çš„è®­ç»ƒæ•°æ®ã€‚</p>
                            <p class="mb-0">ç³»ç»Ÿå°†ä»è®­ç»ƒæ•°æ®ä¸­è‡ªåŠ¨åˆ’åˆ†éªŒè¯é›†ï¼Œæ— éœ€æ‰‹åŠ¨ä¸Šä¼ å¤šä¸ªæ–‡ä»¶ã€‚</p>
                            <p class="mb-0 mt-2">
                                <small class="text-muted">
                                    éœ€è¦å¯¹åŸå§‹æ•°æ®åšæ¸…æ´—ã€å¯¹é½æˆ–å½’ä¸€åŒ–ï¼Ÿè¯·å…ˆå‰å¾€
                                    <a href="{{ url_for('data_management.index') }}" class="text-decoration-none fw-bold">æ•°æ®ç®¡ç†æ¨¡å—</a>
                                    å®Œæˆæ“ä½œï¼Œå†è¿”å›è®­ç»ƒé¡µé¢é€‰æ‹©é¢„å¤„ç†åçš„æ–‡ä»¶ã€‚
                                </small>
                            </p>
                        </div>

                        <!-- å·¥å†µé€‰æ‹©åŒºåŸŸ -->
                        <div class="param-section dataset-section">
                            <h6><i class="fas fa-filter"></i> å·¥å†µç­›é€‰</h6>
                            <div class="alert alert-info mb-3">
                                <small>
                                    <i class="fas fa-info-circle me-2"></i>
                                    é€‰æ‹©å·¥å†µæ¡ä»¶æ¥ç­›é€‰æ•°æ®æ–‡ä»¶ã€‚è®­ç»ƒé›†å°†è‡ªåŠ¨ç­›é€‰æ ‡ç­¾ä¸º"æ­£å¸¸"çš„æ–‡ä»¶ã€‚
                                </small>
                            </div>
                            <div id="conditionSelectionAreaCnn1d">
                                <div class="text-center py-3">
                                    <div class="spinner-border spinner-border-sm text-primary"></div>
                                    <span class="ms-2 text-muted">åŠ è½½å·¥å†µé€‰é¡¹...</span>
                                </div>
                            </div>
                        </div>

                        <!-- è®­ç»ƒé›†æ–‡ä»¶é€‰æ‹©åŒºåŸŸ -->
                        <div class="param-section dataset-section mt-4" id="trainFileSelectionAreaCnn1d" style="display: none;">
                            <h6><i class="fas fa-folder-open"></i> è®­ç»ƒé›†æ–‡ä»¶é€‰æ‹©</h6>
                            <div class="alert alert-success mb-3">
                                <small>
                                    <i class="fas fa-check-circle me-2"></i>
                                    å·²ç­›é€‰å‡º <span id="trainFileCountCnn1d">0</span> ä¸ªç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶ï¼ˆæ ‡ç­¾=æ­£å¸¸ï¼‰
                                </small>
                            </div>
                            <div id="trainFileListCnn1d" style="max-height: 300px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 0.375rem; padding: 1rem;">
                                <div class="text-muted text-center py-3">è¯·å…ˆé€‰æ‹©å·¥å†µæ¡ä»¶</div>
                            </div>
                            <div class="mt-2">
                                <button type="button" class="btn btn-sm btn-outline-primary" onclick="selectAllTrainFilesCnn1d()">
                                    <i class="fas fa-check-square me-1"></i>å…¨é€‰
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-secondary ms-2" onclick="deselectAllTrainFilesCnn1d()">
                                    <i class="fas fa-square me-1"></i>å–æ¶ˆå…¨é€‰
                                </button>
                            </div>
                        </div>

                        <div class="param-section dataset-section mt-4">
                            <h6><i class="fas fa-chart-pie"></i> æ•°æ®åˆ’åˆ†è®¾ç½®</h6>
                            <div class="param-row">
                                <div class="param-item">
                                    <label class="form-label" for="cnn1dValSplit">
                                        <i class="fas fa-percentage"></i>
                                        <span>éªŒè¯é›†æ¯”ä¾‹</span>
                                    </label>
                                    <input type="number"
                                           class="form-control"
                                           id="cnn1dValSplit"
                                           name="cnn1dValSplit"
                                           value="0.2"
                                           min="0.1"
                                           max="0.5"
                                           step="0.05"
                                           aria-label="éªŒè¯é›†æ¯”ä¾‹">
                                    <div class="form-text">ä»è®­ç»ƒæ•°æ®ä¸­åˆ’åˆ†çš„éªŒè¯é›†æ¯”ä¾‹</div>
                                </div>
                            </div>
                            <div class="alert alert-light border">
                                <small>
                                    <i class="fas fa-lightbulb text-warning me-2"></i>
                                    æ— ç›‘ç£å­¦ä¹ æ¨¡å¼ï¼šè®­ç»ƒé›†ç”¨äºå­¦ä¹ æ­£å¸¸æ¨¡å¼ï¼ŒéªŒè¯é›†ç”¨äºè°ƒå‚å’Œæ—©åœ
                                </small>
                            </div>
                        </div>

                        <!-- æµ‹è¯•é›†æ–‡ä»¶é€‰æ‹©åŒºåŸŸ -->
                        <div class="param-section dataset-section mt-4" id="testFileSelectionAreaCnn1d" style="display: none;">
                            <h6><i class="fas fa-flask"></i> æµ‹è¯•é›†é…ç½®ï¼ˆå¯é€‰ï¼‰</h6>
                            <div class="alert alert-warning mb-3">
                                <small>
                                    <i class="fas fa-exclamation-triangle me-2"></i>
                                    æµ‹è¯•é›†å°†ç­›é€‰æ ‡ç­¾ä¸º"æ­£å¸¸"æˆ–"å¼‚å¸¸"çš„æ–‡ä»¶
                                </small>
                            </div>
                            <div id="testFileListCnn1d" style="max-height: 300px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 0.375rem; padding: 1rem;">
                                <div class="text-muted text-center py-3">è¯·å…ˆé€‰æ‹©å·¥å†µæ¡ä»¶</div>
                            </div>
                            <div class="mt-2">
                                <button type="button" class="btn btn-sm btn-outline-primary" onclick="selectAllTestFilesCnn1d()">
                                    <i class="fas fa-check-square me-1"></i>å…¨é€‰
                                </button>
                                <button type="button" class="btn btn-sm btn-outline-secondary ms-2" onclick="deselectAllTestFilesCnn1d()">
                                    <i class="fas fa-square me-1"></i>å–æ¶ˆå…¨é€‰
                                </button>
                            </div>
                            <div class="alert alert-info border mt-3">
                                <small>
                                    <i class="fas fa-info-circle text-info me-2"></i>
                                    <strong>è¯„ä¼°è¯´æ˜ï¼š</strong>å¦‚æœæä¾›æµ‹è¯•é›†ï¼Œè®­ç»ƒå®Œæˆåå°†è‡ªåŠ¨è¯„ä¼°æ¨¡å‹æ€§èƒ½ï¼Œå¹¶è®¡ç®—é‡æ„è¯¯å·®åˆ†å¸ƒã€å¼‚å¸¸åˆ†æ•°ç»Ÿè®¡ç­‰æŒ‡æ ‡
                                </small>
                            </div>
                        </div>
                    </div>

                    <!-- é€šç”¨ä¸‰ç§æ•°æ®ä¸Šä¼ æ¨¡å¼ (å…¶ä»–æ¨¡å‹ä½¿ç”¨) -->
                    <!-- é€šç”¨æ•°æ®é›†é…ç½®å·²ç§»é™¤ï¼šå¼‚å¸¸æ£€æµ‹æ¨¡å‹éƒ½ä½¿ç”¨processed_fileæ¨¡å¼ -->
                </div>
            </div>
        </div>
        <div class="text-center mt-5 mb-5">
            <div class="row justify-content-center g-3">
                <div class="col-md-4">
                    <button type="submit" class="btn btn-success btn-lg w-100 py-3 shadow-sm">
                        <i class="fas fa-play me-2"></i>
                        <strong>å¼€å§‹è®­ç»ƒ</strong>
                    </button>
                </div>
            </div>
        </div>
    </form>

    <!-- è®­ç»ƒçŠ¶æ€æ˜¾ç¤ºåŒºåŸŸ -->
    <div id="trainingStatus" class="mt-4" style="display: none;">
    </div>
</div>


<script>
// æ¨¡å‹ç±»å‹é…ç½®æ•°æ®
const modelTypeConfigs = {
    cnn_1d_autoencoder: {
        title: "1D CNN Autoencoder å‚æ•°é…ç½®",
        icon: "ğŸ–¼ï¸",
        templateId: "cnn1dAutoencoderTemplate",
        description: {
            type: "1Då·ç§¯è‡ªç¼–ç å™¨",
            usage: "é€‚ç”¨äºæ—¶åºæ•°æ®çš„å¼‚å¸¸æ£€æµ‹ï¼Œé€šè¿‡1Då·ç§¯æå–æ—¶åºç‰¹å¾å¹¶é‡æ„åºåˆ—",
            strength: "å¼ºå¤§çš„æ—¶åºç‰¹å¾æå–èƒ½åŠ›å’Œé‡æ„æ€§èƒ½ï¼Œè®¡ç®—æ•ˆç‡é«˜"
        }
    },
    lstm_autoencoder: {
        title: "LSTM Autoencoder å‚æ•°é…ç½®",
        icon: "ğŸ“ˆ",
        templateId: "lstmAutoencoderTemplate",
        description: {
            type: "LSTMè‡ªç¼–ç å™¨",
            usage: "é€‚ç”¨äºå¤æ‚æ—¶åºæ•°æ®çš„å¼‚å¸¸æ£€æµ‹ï¼Œé€šè¿‡é‡æ„è¯¯å·®è¯†åˆ«å¼‚å¸¸æ¨¡å¼",
            strength: "å¼ºå¤§çš„åºåˆ—å»ºæ¨¡å’Œæ—¶é—´æ¨¡å¼å­¦ä¹ èƒ½åŠ›ï¼Œæ“…é•¿æ£€æµ‹å¤æ‚çš„æ—¶åºå¼‚å¸¸"
        }
    },
    lstm_predictor: {
        title: "LSTM Predictor å‚æ•°é…ç½®",
        icon: "ğŸ¯",
        templateId: "lstmPredictorTemplate",
        description: {
            type: "LSTMé¢„æµ‹å™¨",
            usage: "åŸºäºé¢„æµ‹è¯¯å·®è¿›è¡Œå¼‚å¸¸æ£€æµ‹ï¼Œé€‚åˆå•å˜é‡æ—¶åº",
            strength: "ç²¾ç¡®çš„æœªæ¥å€¼é¢„æµ‹å’Œå¼‚å¸¸åˆ†æ•°è®¡ç®—"
        }
    }
};

function parseIntListInput(value, fallback = []) {
    if (value === null || value === undefined) {
        return [...fallback];
    }

    if (Array.isArray(value)) {
        const parsed = value
            .map((item) => parseInt(String(item).trim(), 10))
            .filter((num) => !Number.isNaN(num));
        return parsed.length ? parsed : [...fallback];
    }

    const result = String(value)
        .split(/[,ï¼Œ]/)
        .map((segment) => segment.trim())
        .filter(Boolean)
        .map((segment) => parseInt(segment, 10))
        .filter((num) => !Number.isNaN(num));

    return result.length ? result : [...fallback];
}

function normalizeDeviceTarget(value) {
    const normalized = (value || 'CPU').toString().trim().toLowerCase();
    if (normalized === 'gpu') {
        return 'GPU';
    }
    if (normalized === 'ascend' || normalized === 'npu' || normalized === 'atlas') {
        return 'Ascend';
    }
    return 'CPU';
}

// åˆ‡æ¢æ¨¡å‹ç±»å‹
function switchModelType(modelType) {
    console.log('åˆ‡æ¢åˆ°æ¨¡å‹ç±»å‹:', modelType);
    
    const config = modelTypeConfigs[modelType];
    if (!config) {
        console.error('æœªçŸ¥çš„æ¨¡å‹ç±»å‹:', modelType);
        showError('æ— æ•ˆçš„æ¨¡å‹ç±»å‹');
        return;
    }

    try {
        // æ›´æ–°æ¨¡å‹é…ç½®åŒºåŸŸæ ‡é¢˜
        updateModelConfigTitle(config);
        
        // åˆ‡æ¢æ•°æ®é›†é…ç½®æ˜¾ç¤º
        switchDatasetConfigDisplay(modelType);
        
        // æ·»åŠ åˆ‡æ¢åŠ¨ç”»
        const configContainer = document.getElementById('dynamicModelConfig');
        configContainer.classList.add('hiding');
        
        // å»¶è¿Ÿæ›´æ–°å†…å®¹ï¼Œé…åˆåŠ¨ç”»æ•ˆæœ
        setTimeout(() => {
            // æ›´æ–°æ¨¡å‹å‚æ•°é…ç½®
            updateModelConfig(config);
            
            // æ˜¾ç¤ºæ–°å†…å®¹
            configContainer.classList.remove('hiding');
            configContainer.classList.add('showing');
            
            // æ¸…é™¤æ˜¾ç¤ºç±»
            setTimeout(() => {
                configContainer.classList.remove('showing');
            }, 300);
        }, 150);
        
        // æ¸…é™¤æ‰€æœ‰é”™è¯¯çŠ¶æ€
        clearAllErrors();
        
    } catch (error) {
        console.error('åˆ‡æ¢æ¨¡å‹ç±»å‹æ—¶å‡ºé”™:', error);
        showError('åˆ‡æ¢æ¨¡å‹æ—¶å‘ç”Ÿé”™è¯¯ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
    }
}

// åˆ‡æ¢æ•°æ®é›†é…ç½®æ˜¾ç¤º
function switchDatasetConfigDisplay(modelType) {
    console.log(`ğŸ”„ [switchDatasetConfigDisplay] åˆ‡æ¢åˆ°æ¨¡å‹ç±»å‹: ${modelType}`);
    
    // éšè—æ‰€æœ‰æ•°æ®é›†é…ç½®åŠå…¶æ–‡ä»¶é€‰æ‹©åŒºåŸŸ
    const configs = [
        { id: 'lstmPredictorDatasetConfig', trainArea: 'trainFileSelectionAreaPredictor', testArea: 'testFileSelectionAreaPredictor' },
        { id: 'lstmAutoencoderDatasetConfig', trainArea: 'trainFileSelectionArea', testArea: 'testFileSelectionArea' },
        { id: 'cnn1dAutoencoderDatasetConfig', trainArea: 'trainFileSelectionAreaCnn1d', testArea: 'testFileSelectionAreaCnn1d' }
    ];
    
    configs.forEach(config => {
        const element = document.getElementById(config.id);
        if (element) {
            element.style.display = 'none';
            console.log(`âœ… å·²éšè—é…ç½®: ${config.id}`);
        }
        // åŒæ—¶éšè—æ–‡ä»¶é€‰æ‹©åŒºåŸŸ
        const trainArea = document.getElementById(config.trainArea);
        const testArea = document.getElementById(config.testArea);
        if (trainArea) trainArea.style.display = 'none';
        if (testArea) testArea.style.display = 'none';
    });
    
    // æ˜¾ç¤ºå¯¹åº”çš„æ•°æ®é›†é…ç½®ï¼ˆå¼‚å¸¸æ£€æµ‹æ¨¡å‹éƒ½ä½¿ç”¨å·¥å†µç­›é€‰æ¨¡å¼ï¼‰
    if (modelType === 'lstm_predictor') {
        const predictorConfig = document.getElementById('lstmPredictorDatasetConfig');
        if (predictorConfig) {
            predictorConfig.style.display = 'block';
            console.log('âœ… å·²æ˜¾ç¤ºLSTM Predictoræ•°æ®é›†é…ç½®');
            // å…ˆæ˜¾ç¤ºæ–‡ä»¶é€‰æ‹©åŒºåŸŸ
            const trainArea = document.getElementById('trainFileSelectionAreaPredictor');
            const testArea = document.getElementById('testFileSelectionAreaPredictor');
            if (trainArea) trainArea.style.display = 'block';
            if (testArea) testArea.style.display = 'block';
            // åŠ è½½å·¥å†µé€‰é¡¹
            setTimeout(() => loadConditionKeys('Predictor'), 100);
        }
    } else if (modelType === 'lstm_autoencoder') {
        const autoencoderConfig = document.getElementById('lstmAutoencoderDatasetConfig');
        if (autoencoderConfig) {
            autoencoderConfig.style.display = 'block';
            console.log('âœ… å·²æ˜¾ç¤ºLSTM Autoencoderæ•°æ®é›†é…ç½®');
            // å…ˆæ˜¾ç¤ºæ–‡ä»¶é€‰æ‹©åŒºåŸŸ
            const trainArea = document.getElementById('trainFileSelectionArea');
            const testArea = document.getElementById('testFileSelectionArea');
            if (trainArea) trainArea.style.display = 'block';
            if (testArea) testArea.style.display = 'block';
            // ç¡®ä¿å·¥å†µé€‰æ‹©åŒºåŸŸå­˜åœ¨
            const conditionArea = document.getElementById('conditionSelectionArea');
            if (!conditionArea) {
                console.error('âŒ æœªæ‰¾åˆ°conditionSelectionAreaå…ƒç´ ');
            } else {
                console.log('âœ… æ‰¾åˆ°conditionSelectionAreaå…ƒç´ ï¼Œå‡†å¤‡åŠ è½½å·¥å†µé€‰é¡¹');
            }
            // åŠ è½½å·¥å†µé€‰é¡¹ï¼ˆLSTM Autoencoderä½¿ç”¨æ— åç¼€çš„å…ƒç´ IDï¼‰
            setTimeout(() => {
                console.log('â° å¼€å§‹ä¸ºLSTM AutoencoderåŠ è½½å·¥å†µé€‰é¡¹...');
                loadConditionKeys(''); // ä½¿ç”¨ç©ºå­—ç¬¦ä¸²ï¼Œå› ä¸ºå…ƒç´ IDæ˜¯conditionSelectionAreaï¼ˆæ— åç¼€ï¼‰
            }, 200);
        } else {
            console.error('âŒ æœªæ‰¾åˆ°lstmAutoencoderDatasetConfigå…ƒç´ ');
        }
    } else if (modelType === 'cnn_1d_autoencoder') {
        const cnn1dConfig = document.getElementById('cnn1dAutoencoderDatasetConfig');
        if (cnn1dConfig) {
            cnn1dConfig.style.display = 'block';
            console.log('âœ… å·²æ˜¾ç¤ºCNN 1D Autoencoderæ•°æ®é›†é…ç½®');
            // å…ˆæ˜¾ç¤ºæ–‡ä»¶é€‰æ‹©åŒºåŸŸ
            const trainArea = document.getElementById('trainFileSelectionAreaCnn1d');
            const testArea = document.getElementById('testFileSelectionAreaCnn1d');
            if (trainArea) trainArea.style.display = 'block';
            if (testArea) testArea.style.display = 'block';
            // ç¡®ä¿å·¥å†µé€‰æ‹©åŒºåŸŸå­˜åœ¨
            const conditionArea = document.getElementById('conditionSelectionAreaCnn1d');
            if (!conditionArea) {
                console.error('âŒ æœªæ‰¾åˆ°conditionSelectionAreaCnn1då…ƒç´ ');
            } else {
                console.log('âœ… æ‰¾åˆ°conditionSelectionAreaCnn1då…ƒç´ ï¼Œå‡†å¤‡åŠ è½½å·¥å†µé€‰é¡¹');
            }
            // åŠ è½½å·¥å†µé€‰é¡¹ï¼ˆå¢åŠ å»¶è¿Ÿç¡®ä¿DOMå·²æ›´æ–°ï¼‰
            setTimeout(() => {
                console.log('â° å¼€å§‹ä¸ºCNN 1D AutoencoderåŠ è½½å·¥å†µé€‰é¡¹...');
                loadConditionKeys('Cnn1d');
            }, 200);
        } else {
            console.error('âŒ æœªæ‰¾åˆ°cnn1dAutoencoderDatasetConfigå…ƒç´ ');
        }
    } else {
        console.warn(`âš ï¸ æœªçŸ¥çš„æ¨¡å‹ç±»å‹: ${modelType}`);
    }
}

// ç¡®ä¿æ•°æ®æ–‡ä»¶åˆ—è¡¨å·²åŠ è½½ï¼ˆé˜²é‡å¤åŠ è½½ï¼‰
let dataFilesLoaded = false;
function ensureDataFilesLoaded() {
    if (!dataFilesLoaded) {
        console.log('é¦–æ¬¡åŠ è½½æ•°æ®æ–‡ä»¶åˆ—è¡¨');
        loadProcessedFiles();
        dataFilesLoaded = true;
    } else {
        console.log('æ•°æ®æ–‡ä»¶åˆ—è¡¨å·²åŠ è½½ï¼Œè·³è¿‡é‡å¤åŠ è½½');
    }
}

// æ›´æ–°æ¨¡å‹é…ç½®åŒºåŸŸæ ‡é¢˜
function updateModelConfigTitle(config) {
    const titleElement = document.getElementById('modelConfigTitle');
    if (titleElement) {
        titleElement.textContent = `${config.icon} ${config.description.type} - æ¨¡å‹è¯´æ˜`;
    }
}

// æ›´æ–°æ¨¡å‹å‚æ•°é…ç½®
function updateModelConfig(config) {
    const container = document.getElementById('dynamicModelConfig');
    const template = document.getElementById(config.templateId);
    
    if (!container) {
        console.error('æ‰¾ä¸åˆ°åŠ¨æ€é…ç½®å®¹å™¨');
        return;
    }
    
    if (!template) {
        console.error(`æ‰¾ä¸åˆ°æ¨¡æ¿: ${config.templateId}`);
        return;
    }
    
    // æ¸…ç©ºå®¹å™¨
    container.innerHTML = '';
    
    // å¤åˆ¶æ¨¡æ¿å†…å®¹
    const templateContent = template.cloneNode(true);
    templateContent.style.display = 'block';
    templateContent.id = ''; // ç§»é™¤IDé¿å…å†²çª
    
    // æ·»åŠ æ¨¡å‹è¯´æ˜
    const descriptionHtml = `
        <div class="alert alert-light border border-info p-3 rounded mb-4">
            <div class="d-flex align-items-start">
                <div class="me-3" style="font-size: 2rem;">${config.icon}</div>
                <div class="flex-grow-1">
                    <h6 class="alert-heading text-info mb-2">
                        <i class="fas fa-info-circle"></i> æ¨¡å‹è¯´æ˜
                    </h6>
                    <ul class="small mb-0">
                        <li><strong>ç±»å‹:</strong> ${config.description.type}</li>
                        <li><strong>é€‚ç”¨åœºæ™¯:</strong> ${config.description.usage}</li>
                        <li><strong>ä¼˜åŠ¿:</strong> ${config.description.strength}</li>
                    </ul>
                </div>
            </div>
        </div>
    `;
    
    // å°†æ¨¡å‹è¯´æ˜æ·»åŠ åˆ°æ¨¡å‹é…ç½®åŒºåŸŸ
    container.innerHTML = descriptionHtml;
    
    // æå–ç½‘ç»œå‚æ•°éƒ¨åˆ†å¹¶æ·»åŠ åˆ°ç½‘ç»œå‚æ•°åŒºåŸŸ
    const networkParamsContent = document.getElementById('networkParamsContent');
    if (networkParamsContent) {
        networkParamsContent.innerHTML = '';
        
        // æŸ¥æ‰¾æ¨¡æ¿ä¸­çš„ç½‘ç»œå‚æ•°éƒ¨åˆ†ï¼ˆparam-sectionï¼‰
        const networkParamsSection = templateContent.querySelector('.param-section');
        if (networkParamsSection) {
            // ç§»é™¤æ ‡é¢˜ï¼ˆå› ä¸ºå·²ç»æœ‰ç»Ÿä¸€çš„æ ‡é¢˜äº†ï¼‰
            const clonedSection = networkParamsSection.cloneNode(true);
            const titleElement = clonedSection.querySelector('h6');
            if (titleElement) {
                titleElement.remove();
            }

            // ç¡®ä¿å…‹éš†å…ƒç´ ä¸­çš„IDå”¯ä¸€æ€§
            const timestamp = Date.now();
            const randomSuffix = Math.random().toString(36).substr(2, 9);

            // å¤„ç†æœ‰IDçš„å…ƒç´ 
            const elementsWithId = clonedSection.querySelectorAll('[id]');
            elementsWithId.forEach((element, index) => {
                if (element.id) {
                    const oldId = element.id;
                    const newId = `${oldId}-dynamic-${timestamp}-${randomSuffix}-${index}`;
                    element.id = newId;

                    // æ›´æ–°å¯¹åº”çš„label[for]å±æ€§
                    const relatedLabel = clonedSection.querySelector(`label[for="${oldId}"]`);
                    if (relatedLabel) {
                        relatedLabel.setAttribute('for', newId);
                    }
                }
            });

            // åªæ³¨å…¥å†…éƒ¨å†…å®¹ï¼Œé¿å…é‡å¤å®¹å™¨
            while (clonedSection.firstChild) {
                networkParamsContent.appendChild(clonedSection.firstChild);
            }
        }
    }
    
    // æ›´æ–°ä»»åŠ¡/æ•°æ®å‚æ•°éƒ¨åˆ†
    updateTaskDataParams(config);
    
    // åœ¨åŠ¨æ€å†…å®¹æ’å…¥åï¼Œè°ƒç”¨æ— éšœç¢åŠŸèƒ½å¢å¼º
    if (window.enhanceFormAccessibility) {
        window.enhanceFormAccessibility(templateContent);
    }
}

// æ›´æ–°ä»»åŠ¡/æ•°æ®å‚æ•°éƒ¨åˆ†
function updateTaskDataParams(config) {
    const modelType = document.getElementById('modelType')?.value;
    const sequenceLengthInput = document.getElementById('sequenceLength');
    const strideInput = document.getElementById('stride');
    
    // æ ¹æ®æ¨¡å‹ç±»å‹è®¾ç½®åºåˆ—é•¿åº¦çš„é»˜è®¤å€¼
    const seqLenMap = {
        'lstm_predictor': 10,
        'lstm_autoencoder': 30,
        'cnn_1d_autoencoder': 50
    };
    
    if (sequenceLengthInput && seqLenMap[modelType]) {
        // æŸ¥æ‰¾æ¨¡å‹ç‰¹å®šçš„åºåˆ—é•¿åº¦è¾“å…¥æ¡†ï¼ˆåœ¨ç½‘ç»œå‚æ•°éƒ¨åˆ†ï¼‰
        setTimeout(() => {
            const modelSeqLenInput = document.querySelector(`input[id*="SeqLen"]`);
            if (modelSeqLenInput && modelSeqLenInput.value) {
                sequenceLengthInput.value = modelSeqLenInput.value;
            } else {
                sequenceLengthInput.value = seqLenMap[modelType];
            }
            
            // å»ºç«‹åŒå‘åŒæ­¥
            if (modelSeqLenInput) {
                sequenceLengthInput.addEventListener('input', function syncSeqLen() {
                    if (modelSeqLenInput) {
                        modelSeqLenInput.value = this.value;
                    }
                });
                
                modelSeqLenInput.addEventListener('input', function syncSeqLen() {
                    if (sequenceLengthInput) {
                        sequenceLengthInput.value = this.value;
                    }
                });
            }
        }, 100);
    }
    
    // åŒæ­¥æ•°æ®æ­¥é•¿
    if (strideInput) {
        setTimeout(() => {
            const modelStrideInput = document.querySelector(`input[id*="Stride"]`);
            if (modelStrideInput) {
                if (modelStrideInput.value) {
                    strideInput.value = modelStrideInput.value;
                } else {
                    modelStrideInput.value = strideInput.value;
                }
                
                // å»ºç«‹åŒå‘åŒæ­¥
                strideInput.addEventListener('input', function syncStride() {
                    if (modelStrideInput) {
                        modelStrideInput.value = this.value;
                    }
                });
                
                modelStrideInput.addEventListener('input', function syncStride() {
                    if (strideInput) {
                        strideInput.value = this.value;
                    }
                });
            }
        }, 100);
    }
    
    // æ³¨æ„ï¼šæ•°æ®é›†é…ç½®çš„æ˜¾ç¤º/éšè—å·²ç”±switchDatasetConfigDisplayå‡½æ•°åœ¨switchModelTypeä¸­å¤„ç†
    // è¿™é‡Œä¸å†éœ€è¦è°ƒç”¨updateDatasetConfigForModel
    
    // éªŒè¯IDå”¯ä¸€æ€§ï¼ˆå¼€å‘è°ƒè¯•ç”¨ï¼‰
    if (console && console.log) {
        const allIds = Array.from(document.querySelectorAll('[id]')).map(el => el.id);
        const duplicates = allIds.filter((id, index) => allIds.indexOf(id) !== index);
        if (duplicates.length > 0) {
            console.warn('æ£€æµ‹åˆ°é‡å¤ID:', [...new Set(duplicates)]);
        }
    }
}

// æ ¹æ®æ¨¡å‹ç±»å‹åˆ‡æ¢æ•°æ®é›†é…ç½®æ˜¾ç¤ºï¼ˆå·²åºŸå¼ƒï¼Œä½¿ç”¨switchDatasetConfigDisplayä»£æ›¿ï¼‰
// æ­¤å‡½æ•°ä¿ç•™æ˜¯ä¸ºäº†å‘åå…¼å®¹ï¼Œä½†å®é™…åŠŸèƒ½å·²ç”±switchDatasetConfigDisplayå¤„ç†
function updateDatasetConfigForModel(modelType) {
    console.warn('âš ï¸ updateDatasetConfigForModelå·²è¢«åºŸå¼ƒï¼Œè¯·ä½¿ç”¨switchDatasetConfigDisplay');
    // ä¸å†æ‰§è¡Œä»»ä½•æ“ä½œï¼Œå› ä¸ºswitchDatasetConfigDisplayå·²ç»åœ¨switchModelTypeä¸­è¢«è°ƒç”¨
    // è¿™ä¸ªå‡½æ•°ä¿ç•™æ˜¯ä¸ºäº†é¿å…è°ƒç”¨å®ƒçš„ä»£ç æŠ¥é”™
}


// æ›´æ–°æ¨¡å¼è¯´æ˜
function updateModeDescription(descConfig) {
    const container = document.getElementById('modeDescriptionSection');

    const contentHtml = descConfig.content.map(item =>
        `<li><strong>${item.text}:</strong> ${item.value}</li>`
    ).join('');

    container.innerHTML = `
        <div class="alert alert-light border border-${descConfig.color} p-3 rounded mb-4 fade-in">
            <div class="d-flex align-items-start">
                <div class="flex-grow-1">
                    <h6 class="alert-heading text-${descConfig.color} mb-2">
                        <i class="${descConfig.icon}"></i> ${descConfig.title}
                    </h6>
                    <ul class="small mb-0">
                        ${contentHtml}
                    </ul>
                </div>
            </div>
        </div>
    `;
}

// æ›´æ–°æ•°æ®åˆ’åˆ†é…ç½®
function updateDataSplitConfig(splitConfig) {
    const container = document.getElementById('dataSplitSection');

    if (!splitConfig) {
        container.innerHTML = '';
        return;
    }

    const fieldsHtml = splitConfig.fields.map(field => `
        <div class="param-item">
            <label class="form-label" for="${field.id}">
                ${field.label}
                ${field.badge ? `<span class="badge bg-${field.disabled ? 'warning' : 'primary'}">${field.badge}</span>` : ''}
            </label>
            <input type="number"
                   class="form-control datasetModeConfig"
                   id="${field.id}"
                   name="${field.id}"
                   value="${field.default || ''}"
                   aria-label="${field.label}"
                   title="${field.label}${field.help ? ': ' + field.help : ''}"
                   ${field.min !== undefined ? `min="${field.min}"` : ''}
                   ${field.max !== undefined ? `max="${field.max}"` : ''}
                   ${field.step !== undefined ? `step="${field.step}"` : ''}
                   ${field.disabled ? 'disabled' : ''}>
            ${field.help ? `<div class="form-text">${field.help}</div>` : ''}
        </div>
    `).join('');

    container.innerHTML = `
        <div class="param-section fade-in">
            <h6>${splitConfig.title}</h6>
            <div class="param-row">
                ${fieldsHtml}
            </div>
        </div>
    `;
}

// æ›´æ–°æ–‡ä»¶é…ç½®
function updateFileConfig(fileConfig) {
    const container = document.getElementById('dataFileSection');

    const filesHtml = fileConfig.files.map(file => `
        <div class="param-row">
            <div class="param-item full-width">
                <label class="form-label" for="${file.id}">
                    ${file.label}
                    <span class="badge bg-${file.required ? 'success' : 'secondary'}">${file.badge}</span>
                </label>
                <input type="file"
                       class="form-control datasetModeConfig"
                       id="${file.id}"
                       name="${file.id}"
                       accept="${file.accept}"
                       aria-label="${file.label}"
                       title="${file.label}${file.help ? ': ' + file.help : ''}"
                       ${file.required ? 'required' : ''}>
                <div class="form-text">${file.help}</div>
            </div>
        </div>
    `).join('');

    container.innerHTML = `
        <div class="param-section fade-in">
            <h6>${fileConfig.title}</h6>
            ${filesHtml}
        </div>
    `;
}

// ç»‘å®šåŠ¨æ€äº‹ä»¶
function bindDynamicEvents(mode) {
    if (mode === 'one') {
        // ç»‘å®šæ¯”ä¾‹å˜åŒ–äº‹ä»¶
        const trainRatioInput = document.getElementById('trainRatio');
        const valRatioInput = document.getElementById('valRatio');

        if (trainRatioInput) {
            trainRatioInput.addEventListener('input', updateTestRatio);
            trainRatioInput.addEventListener('change', updateTestRatio);
        }
        if (valRatioInput) {
            valRatioInput.addEventListener('input', updateTestRatio);
            valRatioInput.addEventListener('change', updateTestRatio);
        }

        // åˆå§‹åŒ–æµ‹è¯•é›†æ¯”ä¾‹
        updateTestRatio();
    }
}

// æ›´æ–°æµ‹è¯•é›†æ¯”ä¾‹ï¼ˆè‡ªåŠ¨è®¡ç®—ï¼‰
function updateTestRatio() {
    const trainRatioInput = document.getElementById('trainRatio');
    const valRatioInput = document.getElementById('valRatio');
    const testRatioInput = document.getElementById('testRatio');

    if (!trainRatioInput || !valRatioInput || !testRatioInput) {
        return;
    }

    const trainRatio = parseFloat(trainRatioInput.value) || 0;
    const valRatio = parseFloat(valRatioInput.value) || 0;
    const testRatio = Math.max(0, parseFloat((1 - trainRatio - valRatio).toFixed(3)));

    testRatioInput.value = testRatio;

    // æ¸…é™¤ä¹‹å‰çš„é”™è¯¯çŠ¶æ€
    trainRatioInput.classList.remove('is-invalid');
    valRatioInput.classList.remove('is-invalid');
    
    // ç§»é™¤ä¹‹å‰çš„é”™è¯¯ä¿¡æ¯
    const errorElements = document.querySelectorAll('.ratio-error');
    errorElements.forEach(el => el.remove());

    // éªŒè¯æ¯”ä¾‹
    const total = trainRatio + valRatio;
    if (total > 1.0) {
        trainRatioInput.classList.add('is-invalid');
        valRatioInput.classList.add('is-invalid');
        
        // æ·»åŠ é”™è¯¯æç¤º
        const errorMsg = document.createElement('div');
        errorMsg.className = 'invalid-feedback ratio-error';
        errorMsg.textContent = `è®­ç»ƒé›†å’ŒéªŒè¯é›†æ¯”ä¾‹ä¹‹å’Œä¸èƒ½è¶…è¿‡1.0 (å½“å‰: ${total.toFixed(3)})`;
        valRatioInput.parentNode.appendChild(errorMsg);
    } else if (testRatio < 0.05) {
        trainRatioInput.classList.add('is-invalid');
        valRatioInput.classList.add('is-invalid');
        
        // æ·»åŠ è­¦å‘Šæç¤º
        const warningMsg = document.createElement('div');
        warningMsg.className = 'invalid-feedback ratio-error';
        warningMsg.textContent = `æµ‹è¯•é›†æ¯”ä¾‹è¿‡å° (${testRatio.toFixed(3)})ï¼Œå»ºè®®è‡³å°‘ä¿ç•™5%ä½œä¸ºæµ‹è¯•é›†`;
        valRatioInput.parentNode.appendChild(warningMsg);
    }

    // æ›´æ–°æµ‹è¯•é›†æ¯”ä¾‹çš„èƒŒæ™¯è‰²
    if (testRatio < 0.05) {
        testRatioInput.style.backgroundColor = '#fff3cd';
    } else if (testRatio === 0) {
        testRatioInput.style.backgroundColor = '#f8d7da';
    } else {
        testRatioInput.style.backgroundColor = '#d1edff';
    }
}

// æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯
function showError(message) {
    // ç§»é™¤ä¹‹å‰çš„é”™è¯¯æç¤º
    const existingError = document.querySelector('.global-error');
    if (existingError) {
        existingError.remove();
    }

    // ä¼˜å…ˆå°è¯•ä½¿ç”¨é€šçŸ¥ç³»ç»Ÿ
    if (window.notificationSystem) {
        window.notificationSystem.showNotification(message, 'error', 8000);
        return;
    }

    // å¤‡ç”¨æ–¹æ¡ˆï¼šåœ¨é¡µé¢é¡¶éƒ¨æ˜¾ç¤ºé”™è¯¯ä¿¡æ¯ï¼Œé¿å…å½±å“æ»šåŠ¨
    let errorContainer = document.getElementById('globalErrorContainer');
    if (!errorContainer) {
        errorContainer = document.createElement('div');
        errorContainer.id = 'globalErrorContainer';
        errorContainer.style.cssText = 'position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 9999; width: 90%; max-width: 600px;';
        document.body.appendChild(errorContainer);
    }

    // åˆ›å»ºé”™è¯¯æç¤º
    const errorDiv = document.createElement('div');
    errorDiv.className = 'alert alert-danger global-error fade-in shadow';
    errorDiv.innerHTML = `
        <i class="fas fa-exclamation-triangle me-2"></i>
        <strong>é”™è¯¯:</strong> ${message}
        <button type="button" class="btn-close alert-close-btn" aria-label="å…³é—­"></button>
    `;
    
    errorContainer.appendChild(errorDiv);
    
    // 3ç§’åè‡ªåŠ¨æ¶ˆå¤±
    setTimeout(() => {
        if (errorDiv && errorDiv.parentElement) {
            errorDiv.remove();
        }
    }, 3000);

    // è‡ªåŠ¨æ¶ˆå¤±
    setTimeout(() => {
        if (errorDiv.parentNode) {
            errorDiv.remove();
        }
    }, 5000);
}

// æ¸…é™¤æ‰€æœ‰é”™è¯¯çŠ¶æ€
function clearAllErrors() {
    // ç§»é™¤is-invalidç±»
    document.querySelectorAll('.is-invalid').forEach(el => {
        el.classList.remove('is-invalid');
    });
    
    // ç§»é™¤é”™è¯¯ä¿¡æ¯
    document.querySelectorAll('.invalid-feedback, .ratio-error').forEach(el => {
        el.remove();
    });
    
    // ç§»é™¤å…¨å±€é”™è¯¯
    document.querySelectorAll('.global-error').forEach(el => {
        el.remove();
    });

    // é‡ç½®inputèƒŒæ™¯è‰²
    document.querySelectorAll('input[type="number"]').forEach(input => {
        input.style.backgroundColor = '';
    });
}

// éªŒè¯å½“å‰æ¨¡å¼çš„è¡¨å•æ•°æ®
function validateCurrentMode() {
    const currentModelType = document.getElementById('modelType')?.value;
    const errors = [];

    console.log('ğŸ” å¼€å§‹éªŒè¯è¡¨å•æ•°æ®ï¼Œå½“å‰æ¨¡å‹ç±»å‹:', currentModelType);

    if (currentModelType === 'lstm_predictor') {
        console.log('âœ… è¿›å…¥LSTMé¢„æµ‹æ¨¡å‹éªŒè¯åˆ†æ”¯');
        // LSTMé¢„æµ‹æ¨¡å‹ï¼šéªŒè¯è®­ç»ƒé›†æ–‡ä»¶é€‰æ‹©ï¼ˆå·¥å†µç­›é€‰æ¨¡å¼ï¼‰
        const selectedTrainFiles = getSelectedFiles('trainPredictor');
        if (!selectedTrainFiles || selectedTrainFiles.length === 0) {
            console.warn('âš ï¸ æœªé€‰æ‹©è®­ç»ƒé›†æ–‡ä»¶');
            errors.push('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªè®­ç»ƒé›†æ–‡ä»¶');
        } else {
            console.log(`âœ… LSTMé¢„æµ‹æ¨¡å‹è®­ç»ƒé›†æ–‡ä»¶éªŒè¯é€šè¿‡ï¼Œå·²é€‰æ‹© ${selectedTrainFiles.length} ä¸ªæ–‡ä»¶`);
        }
    } else if (currentModelType === 'lstm_autoencoder') {
        console.log('âœ… è¿›å…¥LSTMè‡ªç¼–ç å™¨éªŒè¯åˆ†æ”¯');
        // LSTM Autoencoderï¼šéªŒè¯è®­ç»ƒé›†æ–‡ä»¶é€‰æ‹©ï¼ˆå·¥å†µç­›é€‰æ¨¡å¼ï¼‰
        const selectedTrainFiles = getSelectedFiles('train');
        if (!selectedTrainFiles || selectedTrainFiles.length === 0) {
            console.warn('âš ï¸ æœªé€‰æ‹©è®­ç»ƒé›†æ–‡ä»¶');
            errors.push('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªè®­ç»ƒé›†æ–‡ä»¶');
        } else {
            console.log(`âœ… LSTMè‡ªç¼–ç å™¨è®­ç»ƒé›†æ–‡ä»¶éªŒè¯é€šè¿‡ï¼Œå·²é€‰æ‹© ${selectedTrainFiles.length} ä¸ªæ–‡ä»¶`);
        }
    } else if (currentModelType === 'cnn_1d_autoencoder') {
        console.log('âœ… è¿›å…¥1D CNNè‡ªç¼–ç å™¨éªŒè¯åˆ†æ”¯');
        // CNN 1D Autoencoderï¼šéªŒè¯è®­ç»ƒé›†æ–‡ä»¶é€‰æ‹©ï¼ˆå·¥å†µç­›é€‰æ¨¡å¼ï¼‰
        const selectedTrainFiles = getSelectedFiles('trainCnn1d');
        if (!selectedTrainFiles || selectedTrainFiles.length === 0) {
            console.warn('âš ï¸ æœªé€‰æ‹©è®­ç»ƒé›†æ–‡ä»¶');
            errors.push('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªè®­ç»ƒé›†æ–‡ä»¶');
        } else {
            console.log(`âœ… 1D CNNè‡ªç¼–ç å™¨è®­ç»ƒé›†æ–‡ä»¶éªŒè¯é€šè¿‡ï¼Œå·²é€‰æ‹© ${selectedTrainFiles.length} ä¸ªæ–‡ä»¶`);
        }
    } else {
        console.log('âš ï¸ è¿›å…¥é€šç”¨æ¨¡å¼éªŒè¯åˆ†æ”¯ï¼Œæ¨¡å‹ç±»å‹:', currentModelType);
        // å…¶ä»–æ¨¡å‹ï¼šä½¿ç”¨åŸæœ‰çš„éªŒè¯é€»è¾‘
        const selectedMode = document.querySelector('input[name="datasetMode"]:checked')?.value;
        console.log('å½“å‰é€‰ä¸­çš„æ•°æ®é›†æ¨¡å¼:', selectedMode);
        
        console.log('ğŸ” [é€šç”¨éªŒè¯] æ£€æŸ¥å„ç§æ¨¡å¼å…ƒç´ çŠ¶æ€:');
        console.log('   - modeOneå­˜åœ¨:', !!document.getElementById('modeOne'));
        console.log('   - modeTwoå­˜åœ¨:', !!document.getElementById('modeTwo'));
        console.log('   - modeThreeå­˜åœ¨:', !!document.getElementById('modeThree'));
        console.log('   - é€‰ä¸­çŠ¶æ€æ£€æŸ¥:');
        const radios = document.querySelectorAll('input[name="datasetMode"]');
        radios.forEach((radio, index) => {
            console.log(`     Radio ${index + 1} (${radio.value}): checked=${radio.checked}, disabled=${radio.disabled}, visible=${radio.parentElement.style.display !== 'none'}`);
        });

        if (selectedMode === 'one') {
            // éªŒè¯æ¨¡å¼1
            console.log('ğŸ” [é€šç”¨éªŒè¯] è¿›å…¥æ¨¡å¼1éªŒè¯');
            const trainRatio = parseFloat(document.getElementById('trainRatio')?.value) || 0;
            const valRatio = parseFloat(document.getElementById('valRatio')?.value) || 0;
            const datasetFileInput = document.getElementById('datasetFileMode1');
            const datasetFile = datasetFileInput?.files.length;
            
            console.log('ğŸ” [é€šç”¨éªŒè¯] æ¨¡å¼1æ£€æŸ¥ç»“æœ:', {
                trainRatio,
                valRatio,
                datasetFileInput_exists: !!datasetFileInput,
                files_length: datasetFile,
                total_ratio: trainRatio + valRatio
            });
            
            if (trainRatio + valRatio >= 1.0) {
                console.warn('âš ï¸ [é€šç”¨éªŒè¯] è®­ç»ƒé›†å’ŒéªŒè¯é›†æ¯”ä¾‹ä¹‹å’Œè¶…è¿‡1.0');
                errors.push('è®­ç»ƒé›†å’ŒéªŒè¯é›†æ¯”ä¾‹ä¹‹å’Œå¿…é¡»å°äº1.0');
            }
            if (!datasetFile) {
                console.warn('âš ï¸ [é€šç”¨éªŒè¯] æœªé€‰æ‹©æ•°æ®é›†æ–‡ä»¶ - è¿™é‡Œäº§ç”Ÿäº†é”™è¯¯æ¶ˆæ¯!');
                errors.push('è¯·é€‰æ‹©æ•°æ®é›†æ–‡ä»¶');
            }
        } else if (selectedMode === 'two') {
            // éªŒè¯æ¨¡å¼2
            const trainFile = document.getElementById('trainFileMode2')?.files.length;
            const testFile = document.getElementById('testFileMode2')?.files.length;
            
            if (!trainFile) errors.push('è¯·é€‰æ‹©è®­ç»ƒé›†æ–‡ä»¶');
            if (!testFile) errors.push('è¯·é€‰æ‹©æµ‹è¯•é›†æ–‡ä»¶');
        } else if (selectedMode === 'three') {
            // éªŒè¯æ¨¡å¼3
            const trainFile = document.getElementById('trainFileMode3')?.files.length;
            const valFile = document.getElementById('valFileMode3')?.files.length;
            const testFile = document.getElementById('testFileMode3')?.files.length;
            
            if (!trainFile) errors.push('è¯·é€‰æ‹©è®­ç»ƒé›†æ–‡ä»¶');
            if (!valFile) errors.push('è¯·é€‰æ‹©éªŒè¯é›†æ–‡ä»¶');
            if (!testFile) errors.push('è¯·é€‰æ‹©æµ‹è¯•é›†æ–‡ä»¶');
        }
    }

    console.log('ğŸ” éªŒè¯å®Œæˆï¼Œé”™è¯¯æ•°é‡:', errors.length, 'é”™è¯¯ä¿¡æ¯:', errors);
    return errors;
}

// é¡µé¢åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    console.log('é¡µé¢åŠ è½½å®Œæˆï¼Œåˆå§‹åŒ–æ¨¡å‹å’Œæ•°æ®é›†é…ç½®');
    
    try {
        // åˆå§‹åŒ–æ¨¡å‹ç±»å‹ï¼ˆé»˜è®¤é€‰æ‹©LSTM Predictorï¼‰
        const defaultModelType = document.getElementById('modelType')?.value || 'lstm_predictor';
        switchModelType(defaultModelType);
        
        // LSTMé¢„æµ‹æ¨¡å‹ä¸éœ€è¦åˆå§‹åŒ–æ•°æ®é›†æ¨¡å¼ï¼Œå› ä¸ºå®ƒä½¿ç”¨ä¸“ç”¨é…ç½®
        // å…¶ä»–æ¨¡å‹ä¼šåœ¨updateDatasetConfigForModelä¸­åˆå§‹åŒ–é€šç”¨é…ç½®
        
        // ä¸ºæ¨¡å‹ç±»å‹é€‰æ‹©æ·»åŠ å˜åŒ–ç›‘å¬
        const modelTypeSelect = document.getElementById('modelType');
        if (modelTypeSelect) {
            modelTypeSelect.addEventListener('change', function() {
                switchModelType(this.value);
            });
        }
        
        // ä¸ºåŠ è½½é»˜è®¤é…ç½®æŒ‰é’®æ·»åŠ åŠŸèƒ½
        document.getElementById('loadDefaultsBtn')?.addEventListener('click', function() {
            loadDefaultConfiguration();
        });
        
        // è®­ç»ƒç›¸å…³äº‹ä»¶å·²ç”±TrainingExecutoræ¨¡å—å¤„ç†
        
    } catch (error) {
        console.error('é¡µé¢åˆå§‹åŒ–å¤±è´¥:', error);
        showError('é¡µé¢åˆå§‹åŒ–å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•');
    }
});

// åŠ è½½é»˜è®¤é…ç½®
function loadDefaultConfiguration() {
    try {
        // é‡æ–°åˆå§‹åŒ–å½“å‰é€‰æ‹©çš„æ¨¡å‹
        const currentModelType = document.getElementById('modelType')?.value;
        if (currentModelType) {
            switchModelType(currentModelType);
        }
        
        // æ˜¾ç¤ºæˆåŠŸæç¤º
        const successDiv = document.createElement('div');
        successDiv.className = 'alert alert-success fade-in';
        successDiv.innerHTML = `
            <i class="fas fa-check-circle me-2"></i>
            <strong>æˆåŠŸ:</strong> é»˜è®¤é…ç½®å·²åŠ è½½
            <button type="button" class="btn-close alert-close-btn" aria-label="å…³é—­"></button>
        `;
        
        const datasetConfig = document.getElementById('datasetConfig');
        datasetConfig.insertBefore(successDiv, datasetConfig.firstChild);
        
        // è‡ªåŠ¨æ¶ˆå¤±
        setTimeout(() => {
            if (successDiv.parentNode) {
                successDiv.remove();
            }
        }, 3000);
        
    } catch (error) {
        console.error('åŠ è½½é»˜è®¤é…ç½®å¤±è´¥:', error);
        showError('åŠ è½½é»˜è®¤é…ç½®å¤±è´¥');
    }
}

// é¡µé¢åˆå§‹åŒ–æ—¶æ¸…ç†å¯èƒ½çš„é‡å¤äº‹ä»¶ç›‘å¬å™¨
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('zeroCodeForm');
    if (!form) {
        return;
    }

    // æ·»åŠ å…¨å±€è¡¨å•æäº¤æ‹¦æˆªå™¨è¿›è¡Œè°ƒè¯•
    const originalAddEventListener = form.addEventListener;
    form.addEventListener = function(type, listener, options) {
        if (type === 'submit') {
            console.log('ğŸ¯ [å…¨å±€æ‹¦æˆªå™¨] æ£€æµ‹åˆ°è¡¨å•æäº¤ç›‘å¬å™¨è¢«æ³¨å†Œ:', listener.name || 'åŒ¿åå‡½æ•°');
        }
        return originalAddEventListener.call(this, type, listener, options);
    };

    // æ‹¦æˆªåŸç”Ÿè¡¨å•æäº¤
    form.addEventListener('submit', function(e) {
        console.log('ğŸš¨ [å…¨å±€æ‹¦æˆªå™¨] è¡¨å•æäº¤äº‹ä»¶è§¦å‘ - äº‹ä»¶é˜¶æ®µ:', e.eventPhase);
        console.log('ğŸš¨ [å…¨å±€æ‹¦æˆªå™¨] äº‹ä»¶ç›®æ ‡:', e.target);
        console.log('ğŸš¨ [å…¨å±€æ‹¦æˆªå™¨] å½“å‰æ¨¡å‹ç±»å‹:', document.getElementById('modelType')?.value);
        console.log('ğŸš¨ [å…¨å±€æ‹¦æˆªå™¨] è°ƒç”¨å †æ ˆ:');
        console.trace();
    }, true); // ä½¿ç”¨æ•è·é˜¶æ®µç¡®ä¿æœ€å…ˆæ‰§è¡Œ

    const modernExecutorAvailable = window.trainingExecutor && typeof window.trainingExecutor.handleTrainingSubmit === 'function';
    if (modernExecutorAvailable) {
        console.debug('ğŸ”§ [LegacyFormHandler] æ£€æµ‹åˆ° TrainingExecutorï¼Œè·³è¿‡æ—§ç‰ˆæäº¤å¤„ç†é€»è¾‘');
        return;
    }

    // å¼ºåˆ¶ç¦ç”¨HTML5éªŒè¯
    form.noValidate = true;

    // ç§»é™¤å¯èƒ½çš„é‡å¤äº‹ä»¶ç›‘å¬å™¨
    form.removeEventListener('submit', handleFormSubmit);

    // ç¡®ä¿åªæœ‰ä¸€ä¸ªæäº¤äº‹ä»¶å¤„ç†å™¨
    form.addEventListener('submit', handleFormSubmit);

    // æ·»åŠ è°ƒè¯•ç›‘å¬å™¨æ¥æ•è·æ„å¤–çš„æ»šåŠ¨
    let isSubmitting = false;
    const originalSubmit = form.submit;
    form.submit = function() {
        console.log('[DEBUG] æ‹¦æˆªform.submitè°ƒç”¨');
        return false; // é˜»æ­¢ç›´æ¥è°ƒç”¨submit
    };

    // ç›‘å¬è®­ç»ƒæŒ‰é’®çš„ç‚¹å‡»
    const submitButton = form.querySelector('button[type="submit"]');
    if (submitButton) {
        submitButton.addEventListener('click', function(e) {
            console.log('[DEBUG] è®­ç»ƒæŒ‰é’®ç‚¹å‡»äº‹ä»¶');
            isSubmitting = true;

            // ä¿å­˜æ»šåŠ¨ä½ç½®ä½†ä¸é”å®šé¡µé¢
            window.lastScrollY = window.scrollY;
            console.log('[DEBUG] ä¿å­˜æ»šåŠ¨ä½ç½®:', window.lastScrollY);

            // çŸ­æš‚å»¶è¿Ÿåæ¢å¤çŠ¶æ€
            setTimeout(() => {
                isSubmitting = false;
            }, 1000);
        });
    }
});

// ç»Ÿä¸€çš„è¡¨å•æäº¤å¤„ç†å‡½æ•°
function handleFormSubmit(e) {
    console.log('ğŸ“ [handleFormSubmit] è¡¨å•æäº¤äº‹ä»¶è¢«è§¦å‘');
    
    const modernExecutorAvailable = window.trainingExecutor && typeof window.trainingExecutor.handleTrainingSubmit === 'function';
    console.log('ğŸ” [handleFormSubmit] ç°ä»£æ‰§è¡Œå™¨å¯ç”¨:', modernExecutorAvailable);
    
    // æ£€æŸ¥å½“å‰æ¨¡å‹ç±»å‹
    const currentModelType = document.getElementById('modelType')?.value;
    console.log('ğŸ“‹ [handleFormSubmit] å½“å‰æ¨¡å‹ç±»å‹:', currentModelType);
    
    // å¯¹äºLSTMå’ŒCNNæ¨¡å‹ï¼Œå¼ºåˆ¶ä½¿ç”¨æˆ‘ä»¬çš„éªŒè¯é€»è¾‘
    if (currentModelType === 'lstm_predictor' || currentModelType === 'lstm_autoencoder' || currentModelType === 'cnn_1d_autoencoder') {
        console.log('âš ï¸ [handleFormSubmit] LSTMæ¨¡å‹æ£€æµ‹åˆ°ï¼Œå¼ºåˆ¶ä½¿ç”¨å†…å»ºéªŒè¯é€»è¾‘');
        
        e.preventDefault();
        e.stopPropagation();
        e.stopImmediatePropagation();
        
        // å¼ºåˆ¶ç¦ç”¨è¡¨å•éªŒè¯
        const form = e.target;
        if (form) {
            form.noValidate = true;
        }
        
        // éªŒè¯è¡¨å•æ•°æ®
        const errors = validateCurrentMode();
        if (errors.length > 0) {
            showError('è¡¨å•éªŒè¯å¤±è´¥:<br>' + errors.join('<br>'));
            return;
        }
        
        console.log('âœ… [handleFormSubmit] LSTMæ¨¡å‹éªŒè¯é€šè¿‡ï¼Œç»§ç»­æäº¤');
        // å¦‚æœéªŒè¯é€šè¿‡ï¼Œç»§ç»­å¤„ç†æäº¤
        // è¿™é‡Œå¯ä»¥è°ƒç”¨ç°ä»£æ‰§è¡Œå™¨æˆ–æˆ‘ä»¬è‡ªå·±çš„æäº¤é€»è¾‘
        if (modernExecutorAvailable) {
            // è°ƒç”¨ç°ä»£æ‰§è¡Œå™¨å¤„ç†æäº¤ï¼Œä½†è·³è¿‡å®ƒçš„éªŒè¯
            return window.trainingExecutor.handleTrainingSubmit(e, true); // ä¼ é€’trueè¡¨ç¤ºè·³è¿‡éªŒè¯
        } else {
            // ä½¿ç”¨æˆ‘ä»¬è‡ªå·±çš„æäº¤é€»è¾‘
            return handleLSTMTrainingSubmit(e, form);
        }
    }
    
    if (modernExecutorAvailable) {
        console.log('ğŸš€ [handleFormSubmit] ä½¿ç”¨ç°ä»£è®­ç»ƒæ‰§è¡Œå™¨');
        // ç°ä»£è®­ç»ƒæ‰§è¡Œå™¨ä¼šæ¥ç®¡æäº¤æµç¨‹
        return;
    }

    console.log('ğŸ“œ [handleFormSubmit] ä½¿ç”¨ä¼ ç»Ÿæäº¤å¤„ç†é€»è¾‘');
    e.preventDefault();
    e.stopPropagation();
    e.stopImmediatePropagation();
    
    // å¼ºåˆ¶ç¦ç”¨è¡¨å•éªŒè¯
    const form = e.target;
    if (form) {
        form.noValidate = true;
    }
    
    // éªŒè¯è¡¨å•æ•°æ®
    const errors = validateCurrentMode();
    if (errors.length > 0) {
        showError('è¡¨å•éªŒè¯å¤±è´¥:<br>' + errors.join('<br>'));
        return;
    }
    
    // æ”¶é›†è¡¨å•æ•°æ®
    const formData = new FormData(form);
    const trainingData = {};
    
    // è·å–å½“å‰æ¨¡å‹ç±»å‹
    const currentModelTypeForData = document.getElementById('modelType')?.value;
    
    // å¤„ç†åŸºæœ¬å‚æ•°
    if (currentModelTypeForData === 'lstm_predictor') {
        // LSTMé¢„æµ‹æ¨¡å‹ï¼šä½¿ç”¨å·¥å†µç­›é€‰å’Œæ–‡ä»¶é€‰æ‹©
        const selectedTrainFiles = getSelectedFiles('trainPredictor');
        if (!selectedTrainFiles || selectedTrainFiles.length === 0) {
            alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªè®­ç»ƒé›†æ–‡ä»¶');
            e.preventDefault();
            return;
        }
        
        trainingData.train_files = selectedTrainFiles;
        trainingData.validation_split = parseFloat(formData.get('predictorValSplit') || '0.2');
        trainingData.random_seed = parseInt(formData.get('randomSeed') || '42');
        trainingData.dataset_mode = 'condition_filtered'; // æ–°çš„æ•°æ®æ¨¡å¼ï¼šå·¥å†µç­›é€‰æ¨¡å¼
        trainingData.conditions = selectedConditions; // ä¼ é€’å·¥å†µæ¡ä»¶
        
        // æµ‹è¯•é›†æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
        const selectedTestFiles = getSelectedFiles('testPredictor');
        if (selectedTestFiles && selectedTestFiles.length > 0) {
            trainingData.test_files = selectedTestFiles;
        }
    } else if (currentModelTypeForData === 'lstm_autoencoder') {
        // LSTM Autoencoderï¼šä½¿ç”¨å·¥å†µç­›é€‰å’Œæ–‡ä»¶é€‰æ‹©
        // è·å–é€‰ä¸­çš„è®­ç»ƒé›†æ–‡ä»¶
        const selectedTrainFiles = getSelectedFiles('train');
        if (!selectedTrainFiles || selectedTrainFiles.length === 0) {
            alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªè®­ç»ƒé›†æ–‡ä»¶');
            e.preventDefault();
            return;
        }
        
        trainingData.train_files = selectedTrainFiles;
        trainingData.validation_split = parseFloat(formData.get('autoencoderValSplit') || '0.2');
        trainingData.random_seed = parseInt(formData.get('randomSeed') || '42');
        trainingData.dataset_mode = 'condition_filtered'; // æ–°çš„æ•°æ®æ¨¡å¼ï¼šå·¥å†µç­›é€‰æ¨¡å¼
        trainingData.conditions = selectedConditions; // ä¼ é€’å·¥å†µæ¡ä»¶
        
        // æµ‹è¯•é›†æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
        const selectedTestFiles = getSelectedFiles('test');
        if (selectedTestFiles && selectedTestFiles.length > 0) {
            trainingData.test_files = selectedTestFiles;
        }
    } else if (currentModelTypeForData === 'cnn_1d_autoencoder') {
        // CNN 1D Autoencoderï¼šä½¿ç”¨å·¥å†µç­›é€‰å’Œæ–‡ä»¶é€‰æ‹©
        // è·å–é€‰ä¸­çš„è®­ç»ƒé›†æ–‡ä»¶
        const selectedTrainFiles = getSelectedFiles('trainCnn1d');
        if (!selectedTrainFiles || selectedTrainFiles.length === 0) {
            alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªè®­ç»ƒé›†æ–‡ä»¶');
            e.preventDefault();
            return;
        }
        
        trainingData.train_files = selectedTrainFiles;
        trainingData.validation_split = parseFloat(formData.get('cnn1dValSplit') || '0.2');
        trainingData.random_seed = parseInt(formData.get('randomSeed') || '42');
        trainingData.dataset_mode = 'condition_filtered'; // æ–°çš„æ•°æ®æ¨¡å¼ï¼šå·¥å†µç­›é€‰æ¨¡å¼
        trainingData.conditions = selectedConditions; // ä¼ é€’å·¥å†µæ¡ä»¶
        
        // æµ‹è¯•é›†æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
        const selectedTestFiles = getSelectedFiles('testCnn1d');
        if (selectedTestFiles && selectedTestFiles.length > 0) {
            trainingData.test_files = selectedTestFiles;
        }
    } else {
        // å…¶ä»–æ¨¡å‹ï¼šä½¿ç”¨é€šç”¨é…ç½®
        trainingData.data_path = formData.get('datasetFileMode1') || formData.get('trainFileMode2') || formData.get('trainFileMode3');
        trainingData.dataset_mode = formData.get('datasetMode');
        
        if (trainingData.dataset_mode === 'one') {
            trainingData.train_ratio = parseFloat(formData.get('trainRatio') || '0.7');
            trainingData.val_ratio = parseFloat(formData.get('valRatio') || '0.2');
        } else if (trainingData.dataset_mode === 'two') {
            trainingData.test_file = formData.get('testFileMode2');
        } else if (trainingData.dataset_mode === 'three') {
            trainingData.val_file = formData.get('valFileMode3');
            trainingData.test_file = formData.get('testFileMode3');
        }
    }
    
    // è®¾ç½®æ¨¡å‹ç±»å‹
    trainingData.model_type = currentModelTypeForData;
    
    // ä»ä»»åŠ¡/æ•°æ®å‚æ•°éƒ¨åˆ†è·å–åºåˆ—é•¿åº¦å’Œæ•°æ®æ­¥é•¿ï¼ˆç»Ÿä¸€è¾“å…¥æ¡†ï¼‰
    trainingData.sequence_length = parseInt(document.getElementById('sequenceLength')?.value || formData.get('sequenceLength') || '10');
    trainingData.stride = parseInt(document.getElementById('stride')?.value || formData.get('stride') || '1');
    
    // å¤„ç†LSTMç›¸å…³å‚æ•°
    if (currentModelTypeForData === 'lstm_predictor') {
        trainingData.hidden_units = parseInt(document.querySelector('input[id*="PredHiddenDim"]')?.value || formData.get('lstmPredHiddenDim') || '64');
        trainingData.num_layers = parseInt(document.querySelector('input[id*="PredNumLayers"]')?.value || formData.get('lstmPredNumLayers') || '2');
        trainingData.dropout = parseFloat(document.querySelector('input[id*="PredDropout"]')?.value || formData.get('lstmPredDropout') || '0.1');
        trainingData.activation = document.querySelector('select[id*="PredActivation"]')?.value || formData.get('lstmPredActivation') || 'tanh';
        trainingData.bidirectional = (document.querySelector('select[id*="PredBidirectional"]')?.value || formData.get('lstmPredBidirectional')) === 'true';
        trainingData.layer_norm = (document.querySelector('select[id*="PredLayerNorm"]')?.value || formData.get('lstmPredLayerNorm')) === 'true';
        trainingData.prediction_horizon = 1; // LSTMé¢„æµ‹å™¨å‰ç«¯å›ºå®šä¸ºå•æ­¥é¢„æµ‹
    } else if (currentModelTypeForData === 'lstm_autoencoder') {
        trainingData.hidden_units = parseInt(document.querySelector('input[id*="AeHiddenSize"]')?.value || formData.get('lstmAeHiddenSize') || '128');
        trainingData.num_layers = parseInt(document.querySelector('input[id*="AeNumLayers"]')?.value || formData.get('lstmAeNumLayers') || '2');
        trainingData.bottleneck_size = parseInt(document.querySelector('input[id*="AeBottleneckDim"]')?.value || formData.get('lstmAeBottleneckDim') || '64');
        trainingData.bottleneck_dim = trainingData.bottleneck_size;
        trainingData.dropout = parseFloat(document.querySelector('input[id*="AeDropout"]')?.value || formData.get('lstmAeDropout') || '0.1');
    } else if (currentModelTypeForData === 'cnn_1d_autoencoder') {
        const convChannelInput = document.querySelector('input[id*="convChannels"]')?.value || formData.get('convChannels');
        const kernelSizeInput = document.querySelector('input[id*="kernelSizes"]')?.value || formData.get('kernelSizes');
        const convChannels = parseIntListInput(convChannelInput, [64, 64, 64]);
        const kernelSizes = parseIntListInput(kernelSizeInput, [3, 3, 3]);

        trainingData.conv_channels = convChannels;
        trainingData.kernel_sizes = kernelSizes;
        trainingData.num_conv_layers = convChannels.length || 3;
        trainingData.num_filters = convChannels[convChannels.length - 1] || convChannels[0] || 64;
        trainingData.kernel_size = kernelSizes[0] || 3;
        trainingData.bottleneck_size = parseInt(document.querySelector('input[id*="cnnBottleneckDim"]')?.value || formData.get('cnnBottleneckDim') || '64');
        trainingData.bottleneck_dim = trainingData.bottleneck_size;
        const dropoutValue = document.querySelector('[name="dropout"]')?.value || formData.get('dropout') || formData.get('cnnDropout');
        const activationValue = document.querySelector('[name="activation"]')?.value || formData.get('activation') || formData.get('cnnActivation');
        trainingData.dropout = parseFloat(dropoutValue || '0.1');
        trainingData.activation = activationValue || 'relu';
    }
    
    // å¤„ç†é€šç”¨è®­ç»ƒå‚æ•°
    trainingData.epochs = parseInt(formData.get('numEpochs') || '50');
    trainingData.batch_size = parseInt(formData.get('batchSize') || '32');
    trainingData.learning_rate = parseFloat(formData.get('learningRate') || '0.001');
    trainingData.device_target = normalizeDeviceTarget(formData.get('device'));
    
    // å¤„ç†é˜ˆå€¼è®¡ç®—é…ç½®
    trainingData.threshold_method = formData.get('thresholdMethod') || 'percentile';
    if (trainingData.threshold_method === 'percentile') {
        trainingData.threshold_percentile = parseFloat(formData.get('thresholdPercentile') || '95');
    } else if (trainingData.threshold_method === 'contamination') {
        trainingData.threshold_contamination = parseFloat(formData.get('thresholdContamination') || '0.01');
    }
    
    console.log('Training data:', trainingData);
    
    // å‘é€è®­ç»ƒè¯·æ±‚åˆ°äº‘ç«¯API
    startTraining(trainingData);
}

// å¼€å§‹è®­ç»ƒ
async function startTraining(trainingData) {
    try {
        // æ˜¾ç¤ºè®­ç»ƒçŠ¶æ€
        showTrainingStatus('æ­£åœ¨è¿æ¥äº‘ç«¯æœåŠ¡...', 'info');
        
        const response = await fetch('/anomaly_detection/api/train', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(trainingData)
        });
        
        const result = await response.json();
        
        if (result.success) {
            showTrainingStatus('è®­ç»ƒä»»åŠ¡å·²æäº¤åˆ°äº‘ç«¯ï¼Œæ­£åœ¨åå°æ‰§è¡Œ...', 'success');
            console.log('Training started:', result);
            
            // è·å–task_idå¹¶è·³è½¬åˆ°ç›‘æ§é¡µé¢
            const taskId = result.task_id || result.cloud_task_id || 'unknown';
            console.log('Task ID:', taskId);
            
            // æ˜¾ç¤ºè·³è½¬æç¤º
            setTimeout(() => {
                showTrainingStatus(`è®­ç»ƒå·²å¼€å§‹ (ä»»åŠ¡ID: ${taskId})ï¼Œå³å°†è·³è½¬åˆ°ç›‘æ§é¡µé¢...`, 'success');
            }, 1000);
            
            // 2ç§’åè‡ªåŠ¨è·³è½¬åˆ°ç›‘æ§é¡µé¢
            setTimeout(() => {
                window.location.href = `/anomaly_detection/training_progress?task_id=${taskId}`;
            }, 2000);
        } else {
            throw new Error(result.error || 'è®­ç»ƒå¯åŠ¨å¤±è´¥');
        }
        
    } catch (error) {
        console.error('Training error:', error);
        showTrainingStatus('è®­ç»ƒå¯åŠ¨å¤±è´¥: ' + error.message, 'error');
    }
}

// ç›‘æ§è®­ç»ƒçŠ¶æ€
function monitorTrainingStatus() {
    // è¿™é‡Œå¯ä»¥å®ç°è½®è¯¢æˆ–WebSocketæ¥ç›‘æ§è®­ç»ƒè¿›åº¦
    // æš‚æ—¶æ˜¾ç¤ºé™æ€æ¶ˆæ¯
    setTimeout(() => {
        showTrainingStatus('è®­ç»ƒæ­£åœ¨äº‘ç«¯æ‰§è¡Œï¼Œè¯·ç¨åæŸ¥çœ‹æ¨¡å‹åˆ—è¡¨...', 'info');
    }, 3000);
}

// LSTMæ¨¡å‹ä¸“ç”¨çš„è®­ç»ƒæäº¤å¤„ç†å‡½æ•°
function handleLSTMTrainingSubmit(e, form) {
    console.log('ğŸ“ˆ [handleLSTMTrainingSubmit] å¼€å§‹å¤„ç†LSTMæ¨¡å‹è®­ç»ƒæäº¤');
    
    // æ”¶é›†è¡¨å•æ•°æ®
    const formData = new FormData(form);
    const trainingData = {};
    
    // è·å–å½“å‰æ¨¡å‹ç±»å‹
    const currentModelType = document.getElementById('modelType')?.value;
    
    // å¤„ç†åŸºæœ¬å‚æ•°
    if (currentModelType === 'lstm_predictor') {
        // LSTMé¢„æµ‹æ¨¡å‹ï¼šä½¿ç”¨å·¥å†µç­›é€‰å’Œæ–‡ä»¶é€‰æ‹©
        const selectedTrainFiles = getSelectedFiles('trainPredictor');
        if (!selectedTrainFiles || selectedTrainFiles.length === 0) {
            alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªè®­ç»ƒé›†æ–‡ä»¶');
            e.preventDefault();
            return;
        }
        
        trainingData.train_files = selectedTrainFiles;
        trainingData.validation_split = parseFloat(formData.get('predictorValSplit') || '0.2');
        trainingData.random_seed = parseInt(formData.get('randomSeed') || '42');
        trainingData.dataset_mode = 'condition_filtered'; // æ–°çš„æ•°æ®æ¨¡å¼ï¼šå·¥å†µç­›é€‰æ¨¡å¼
        trainingData.conditions = selectedConditions; // ä¼ é€’å·¥å†µæ¡ä»¶
        
        // æµ‹è¯•é›†æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
        const selectedTestFiles = getSelectedFiles('testPredictor');
        if (selectedTestFiles && selectedTestFiles.length > 0) {
            trainingData.test_files = selectedTestFiles;
        }
    } else if (currentModelType === 'lstm_autoencoder') {
        // LSTM Autoencoderï¼šä½¿ç”¨å·¥å†µç­›é€‰å’Œæ–‡ä»¶é€‰æ‹©
        const selectedTrainFiles = getSelectedFiles('train');
        if (!selectedTrainFiles || selectedTrainFiles.length === 0) {
            alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªè®­ç»ƒé›†æ–‡ä»¶');
            e.preventDefault();
            return;
        }
        
        trainingData.train_files = selectedTrainFiles;
        trainingData.validation_split = parseFloat(formData.get('autoencoderValSplit') || '0.2');
        trainingData.random_seed = parseInt(formData.get('randomSeed') || '42');
        trainingData.dataset_mode = 'condition_filtered'; // æ–°çš„æ•°æ®æ¨¡å¼ï¼šå·¥å†µç­›é€‰æ¨¡å¼
        trainingData.conditions = selectedConditions; // ä¼ é€’å·¥å†µæ¡ä»¶
        
        // æµ‹è¯•é›†æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
        const selectedTestFiles = getSelectedFiles('test');
        if (selectedTestFiles && selectedTestFiles.length > 0) {
            trainingData.test_files = selectedTestFiles;
        }
    } else if (currentModelType === 'cnn_1d_autoencoder') {
        // CNN 1D Autoencoderï¼šä½¿ç”¨å·¥å†µç­›é€‰å’Œæ–‡ä»¶é€‰æ‹©
        const selectedTrainFiles = getSelectedFiles('trainCnn1d');
        if (!selectedTrainFiles || selectedTrainFiles.length === 0) {
            alert('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªè®­ç»ƒé›†æ–‡ä»¶');
            e.preventDefault();
            return;
        }
        
        trainingData.train_files = selectedTrainFiles;
        trainingData.validation_split = parseFloat(formData.get('cnn1dValSplit') || '0.2');
        trainingData.random_seed = parseInt(formData.get('randomSeed') || '42');
        trainingData.dataset_mode = 'condition_filtered'; // æ–°çš„æ•°æ®æ¨¡å¼ï¼šå·¥å†µç­›é€‰æ¨¡å¼
        trainingData.conditions = selectedConditions; // ä¼ é€’å·¥å†µæ¡ä»¶
        
        // æµ‹è¯•é›†æ–‡ä»¶ï¼ˆå¯é€‰ï¼‰
        const selectedTestFiles = getSelectedFiles('testCnn1d');
        if (selectedTestFiles && selectedTestFiles.length > 0) {
            trainingData.test_files = selectedTestFiles;
        }
    }
    
    // è®¾ç½®æ¨¡å‹ç±»å‹
    trainingData.model_type = currentModelType;
    
    // å¤„ç†LSTMç›¸å…³å‚æ•°
    if (currentModelType === 'lstm_predictor') {
        trainingData.sequence_length = parseInt(formData.get('lstmSeqLen') || '10');
        trainingData.hidden_units = parseInt(formData.get('lstmPredHiddenDim') || '64');
        trainingData.num_layers = parseInt(formData.get('lstmPredNumLayers') || '2');
        trainingData.dropout = parseFloat(formData.get('lstmPredDropout') || '0.1');
        trainingData.activation = formData.get('lstmPredActivation') || 'tanh';
        trainingData.bidirectional = formData.get('lstmPredBidirectional') === 'true';
        trainingData.layer_norm = formData.get('lstmPredLayerNorm') === 'true';
        trainingData.prediction_horizon = 1; // å‰ç«¯å›ºå®šå•æ­¥é¢„æµ‹
        trainingData.stride = parseInt(formData.get('lstmPredStride') || '1');
    } else if (currentModelType === 'lstm_autoencoder') {
        trainingData.sequence_length = parseInt(formData.get('lstmAeSeqLen') || '30');
        trainingData.hidden_units = parseInt(formData.get('lstmAeHiddenSize') || '128');
        trainingData.num_layers = parseInt(formData.get('lstmAeNumLayers') || '2');
        trainingData.bottleneck_size = parseInt(formData.get('lstmAeBottleneckDim') || '64');
        trainingData.bottleneck_dim = trainingData.bottleneck_size;
        trainingData.dropout = parseFloat(formData.get('lstmAeDropout') || '0.1');
        trainingData.stride = parseInt(formData.get('lstmAeStride') || '1');
    } else if (currentModelType === 'cnn_1d_autoencoder') {
        const convChannels = parseIntListInput(formData.get('convChannels'), [64, 64, 64]);
        const kernelSizes = parseIntListInput(formData.get('kernelSizes'), [3, 3, 3]);

        trainingData.sequence_length = parseInt(formData.get('sequenceLength') || '50');
        trainingData.conv_channels = convChannels;
        trainingData.kernel_sizes = kernelSizes;
        trainingData.num_conv_layers = convChannels.length || 3;
        trainingData.num_filters = convChannels[convChannels.length - 1] || convChannels[0] || 64;
        trainingData.kernel_size = kernelSizes[0] || 3;
        trainingData.bottleneck_size = parseInt(formData.get('cnnBottleneckDim') || '64');
        trainingData.bottleneck_dim = trainingData.bottleneck_size;
        trainingData.dropout = parseFloat(formData.get('dropout') || formData.get('cnnDropout') || '0.1');
        trainingData.activation = formData.get('activation') || formData.get('cnnActivation') || 'relu';
        trainingData.stride = parseInt(formData.get('stride') || '1');
    }
    
    // å¤„ç†é€šç”¨è®­ç»ƒå‚æ•°
    trainingData.epochs = parseInt(formData.get('numEpochs') || '50');
    trainingData.batch_size = parseInt(formData.get('batchSize') || '32');
    trainingData.learning_rate = parseFloat(formData.get('learningRate') || '0.001');
    trainingData.device_target = normalizeDeviceTarget(formData.get('device'));
    
    console.log('ğŸ“Š [handleLSTMTrainingSubmit] è®­ç»ƒæ•°æ®:', trainingData);
    
    // å‘é€è®­ç»ƒè¯·æ±‚åˆ°äº‘ç«¯API
    startTraining(trainingData);
}

// æ˜¾ç¤ºè®­ç»ƒçŠ¶æ€
function showTrainingStatus(message, type = 'info') {
    const statusDiv = document.getElementById('trainingStatus');
    if (!statusDiv) return;
    
    statusDiv.style.display = 'block';
    statusDiv.innerHTML = `
        <div class="alert alert-${type === 'error' ? 'danger' : type === 'success' ? 'success' : 'info'}">
            <h5><i class="fas fa-${type === 'error' ? 'exclamation-triangle' : type === 'success' ? 'check-circle' : 'info-circle'}"></i> è®­ç»ƒçŠ¶æ€</h5>
            <p class="mb-0">${message}</p>
        </div>
    `;
}

// ä¸ºåŠ¨æ€ç”Ÿæˆçš„å…³é—­æŒ‰é’®æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
document.addEventListener('click', function(e) {
    if (e.target.classList.contains('alert-close-btn')) {
        e.target.parentElement.remove();
    }
});

// ä¸ºonchangeæ›¿æ¢åçš„å…ƒç´ æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
document.addEventListener('change', function(e) {
    const action = e.target.getAttribute('data-action');
    
    if (action === 'switch-model-type') {
        switchModelType(e.target.value);
    }
});

// åŠ è½½é¢„å¤„ç†æ•°æ®æ–‡ä»¶åˆ—è¡¨
async function loadProcessedFiles() {
    // è®­ç»ƒæ•°æ®é€‰æ‹©å™¨
    const trainSelects = [
        document.getElementById('predictorDataFile'),
        document.getElementById('autoencoderDataFile')
    ].filter(select => select !== null);
    
    // æµ‹è¯•æ•°æ®é€‰æ‹©å™¨
    const testSelects = [
        document.getElementById('predictorTestFile'),
        document.getElementById('autoencoderTestFile')
    ].filter(select => select !== null);
    
    const allSelects = [...trainSelects, ...testSelects];
    
    console.log('å¼€å§‹åŠ è½½é¢„å¤„ç†æ•°æ®æ–‡ä»¶ï¼Œè®­ç»ƒé€‰æ‹©å™¨:', trainSelects.length, 'æµ‹è¯•é€‰æ‹©å™¨:', testSelects.length);
    
    if (allSelects.length === 0) {
        console.warn('æ²¡æœ‰æ‰¾åˆ°æœ‰æ•ˆçš„selectå…ƒç´ ');
        return;
    }
    
    try {
        // ä¸ºè®­ç»ƒæ•°æ®é€‰æ‹©å™¨è®¾ç½®åŠ è½½çŠ¶æ€
        trainSelects.forEach(select => {
            select.innerHTML = '<option value="">åŠ è½½ä¸­...</option>';
        });
        // ä¸ºæµ‹è¯•æ•°æ®é€‰æ‹©å™¨è®¾ç½®åŠ è½½çŠ¶æ€
        testSelects.forEach(select => {
            select.innerHTML = '<option value="">åŠ è½½ä¸­...</option>';
        });
        
        console.log('æ­£åœ¨è°ƒç”¨API: /anomaly_detection/api/processed_data');
        const response = await fetch('/anomaly_detection/api/processed_data');
        const result = await response.json();
        
        console.log('APIå“åº”:', result);
        
        if (result.success) {
            // ä¸ºè®­ç»ƒæ•°æ®é€‰æ‹©å™¨è®¾ç½®é»˜è®¤é€‰é¡¹
            trainSelects.forEach(select => {
                select.innerHTML = '<option value="">è¯·é€‰æ‹©æ•°æ®æ–‡ä»¶...</option>';
            });
            // ä¸ºæµ‹è¯•æ•°æ®é€‰æ‹©å™¨è®¾ç½®é»˜è®¤é€‰é¡¹ï¼ˆä¸ä½¿ç”¨æµ‹è¯•é›†ï¼‰
            testSelects.forEach(select => {
                select.innerHTML = '<option value="">ä¸ä½¿ç”¨æµ‹è¯•é›†</option>';
            });
            
            if (result.files.length === 0) {
                console.warn('APIè¿”å›çš„æ–‡ä»¶åˆ—è¡¨ä¸ºç©º');
                trainSelects.forEach(select => {
                    select.innerHTML += '<option value="" disabled>æš‚æ— å¯ç”¨çš„é¢„å¤„ç†æ•°æ®æ–‡ä»¶</option>';
                });
                return;
            }
            
            console.log(`æˆåŠŸåŠ è½½ ${result.files.length} ä¸ªæ–‡ä»¶`);
            
            // ä¸ºæ‰€æœ‰selectæ·»åŠ æ–‡ä»¶é€‰é¡¹
            result.files.forEach(file => {
                const option = document.createElement('option');
                option.value = file.filename;
                option.textContent = `${file.display_name} (${(file.size/1024/1024).toFixed(2)}MB)`;
                option.title = `æ–‡ä»¶: ${file.filename}\nå¤§å°: ${(file.size/1024/1024).toFixed(2)}MB\nä¿®æ”¹æ—¶é—´: ${file.modified_time}\næè¿°: ${file.description}`;
                
                // æ·»åŠ åˆ°è®­ç»ƒæ•°æ®é€‰æ‹©å™¨
                trainSelects.forEach(select => {
                    select.appendChild(option.cloneNode(true));
                });
                // æ·»åŠ åˆ°æµ‹è¯•æ•°æ®é€‰æ‹©å™¨
                testSelects.forEach(select => {
                    select.appendChild(option.cloneNode(true));
                });
            });
            
            // è‡ªåŠ¨é€‰æ‹©ç¬¬ä¸€ä¸ªæ–‡ä»¶ï¼ˆä»…å¯¹è®­ç»ƒæ•°æ®é€‰æ‹©å™¨ï¼‰
            if (result.files.length > 0) {
                const firstFile = result.files[0];
                trainSelects.forEach(select => {
                    if (select.options.length > 1) {
                        select.value = firstFile.filename;
                        console.log(`ğŸ¯ è‡ªåŠ¨é€‰æ‹©è®­ç»ƒæ•°æ®æ–‡ä»¶: ${firstFile.filename} ç”¨äº ${select.id}`);
                    }
                });
                // æµ‹è¯•æ•°æ®é€‰æ‹©å™¨ä¿æŒ"ä¸ä½¿ç”¨æµ‹è¯•é›†"
            }
            
            console.log(`âœ… å·²åŠ è½½ ${result.files.length} ä¸ªé¢„å¤„ç†æ•°æ®æ–‡ä»¶`);
        } else {
            throw new Error(result.error || 'åŠ è½½å¤±è´¥');
        }
    } catch (error) {
        console.error('åŠ è½½é¢„å¤„ç†æ•°æ®æ–‡ä»¶å¤±è´¥:', error);
        allSelects.forEach(select => {
            select.innerHTML = '<option value="" disabled>åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é‡è¯•</option>';
        });
        
        // æ˜¾ç¤ºç”¨æˆ·å‹å¥½çš„é”™è¯¯æç¤º
        showError('æ•°æ®æ–‡ä»¶åˆ—è¡¨åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–åˆ·æ–°é¡µé¢é‡è¯•');
    }
}

// åˆ·æ–°é¢„å¤„ç†æ–‡ä»¶åˆ—è¡¨
async function refreshProcessedFiles() {
    console.log('åˆ·æ–°é¢„å¤„ç†æ–‡ä»¶åˆ—è¡¨...');
    dataFilesLoaded = false; // é‡ç½®åŠ è½½æ ‡å¿—
    await loadProcessedFiles();
    dataFilesLoaded = true; // é‡æ–°æ ‡è®°ä¸ºå·²åŠ è½½
}

// ==================== å·¥å†µé€‰æ‹©å’Œæ–‡ä»¶ç­›é€‰åŠŸèƒ½ ====================
let selectedConditions = {}; // {key: [value1, value2, ...]}
window.selectedConditions = selectedConditions; // ç¡®ä¿å…¨å±€å¯è®¿é—®
let trainFiles = []; // è®­ç»ƒé›†æ–‡ä»¶åˆ—è¡¨
let testFiles = []; // æµ‹è¯•é›†æ–‡ä»¶åˆ—è¡¨

// åŠ è½½å·¥å†µkeyåˆ—è¡¨
async function loadConditionKeys(suffix = '') {
    const areaId = suffix ? `conditionSelectionArea${suffix}` : 'conditionSelectionArea';
    console.log(`ğŸ” [loadConditionKeys] æŸ¥æ‰¾å…ƒç´ : ${areaId}, suffix="${suffix}"`);
    const area = document.getElementById(areaId);
    if (!area) {
        console.error(`âŒ æœªæ‰¾åˆ°å…ƒç´ : ${areaId}`);
        console.error(`âŒ å½“å‰é¡µé¢ä¸­æ‰€æœ‰conditionSelectionAreaç›¸å…³å…ƒç´ :`, 
            Array.from(document.querySelectorAll('[id*="conditionSelectionArea"]')).map(el => el.id));
        return;
    }
    console.log(`âœ… æ‰¾åˆ°å…ƒç´ : ${areaId}`, area);
    
    try {
        area.innerHTML = '<div class="text-center py-3"><div class="spinner-border spinner-border-sm text-primary"></div><span class="ms-2 text-muted">åŠ è½½å·¥å†µé€‰é¡¹...</span></div>';
        
        console.log(`ğŸ” [loadConditionKeys] å¼€å§‹åŠ è½½å·¥å†µkeys, suffix="${suffix}"...`);
        const response = await fetch('/anomaly_detection/api/condition_keys');
        console.log('ğŸ“¡ APIå“åº”çŠ¶æ€:', response.status);
        
        if (!response.ok) {
            throw new Error(`HTTP ${response.status}: ${response.statusText}`);
        }
        
        const result = await response.json();
        console.log('ğŸ“¦ APIè¿”å›ç»“æœ:', result);
        
        if (result.success) {
            if (result.keys && result.keys.length > 0) {
                console.log(`âœ… æ‰¾åˆ° ${result.keys.length} ä¸ªå·¥å†µkey:`, result.keys);
                renderConditionKeys(result.keys, suffix);
                // åŠ è½½å®Œå·¥å†µkeyåï¼ŒåŠ è½½æ‰€æœ‰æ•°æ®æ–‡ä»¶
                // å»¶è¿Ÿä¸€ä¸‹ç¡®ä¿DOMå…ƒç´ å·²å‡†å¤‡å¥½
                setTimeout(() => {
                    console.log(`ğŸ” [loadConditionKeys] å‡†å¤‡è°ƒç”¨loadAllFilesï¼ˆæœ‰å·¥å†µkeyï¼‰, suffix="${suffix}"`);
                    if (suffix === 'Predictor') {
                        console.log('ğŸ” å‡†å¤‡åŠ è½½Predictoræ•°æ®æ–‡ä»¶ï¼ˆæœ‰å·¥å†µkeyï¼‰...');
                        loadAllFiles('Predictor');
                    } else if (suffix === 'Cnn1d') {
                        console.log('ğŸ” å‡†å¤‡åŠ è½½CNN 1D Autoencoderæ•°æ®æ–‡ä»¶ï¼ˆæœ‰å·¥å†µkeyï¼‰...');
                        loadAllFiles('Cnn1d');
                    } else {
                        // LSTM Autoencoderä½¿ç”¨æ— åç¼€çš„å…ƒç´ ID
                        console.log('ğŸ” å‡†å¤‡åŠ è½½LSTM Autoencoderæ•°æ®æ–‡ä»¶ï¼ˆæœ‰å·¥å†µkeyï¼‰...');
                        loadAllFiles(''); // ä½¿ç”¨ç©ºå­—ç¬¦ä¸²ï¼Œå› ä¸ºå…ƒç´ IDæ˜¯trainFileSelectionAreaï¼ˆæ— åç¼€ï¼‰
                    }
                }, 500);
            } else {
                console.warn('âš ï¸ æ²¡æœ‰æ‰¾åˆ°å·¥å†µkeyï¼Œå°†æ˜¾ç¤ºæ‰€æœ‰æ•°æ®æ–‡ä»¶');
                area.innerHTML = '<div class="alert alert-info mb-0"><i class="fas fa-info-circle me-2"></i>æœªæ‰¾åˆ°å·¥å†µæ•°æ®ï¼Œå°†æ˜¾ç¤ºæ‰€æœ‰æ•°æ®æ–‡ä»¶ã€‚å¦‚éœ€ä½¿ç”¨å·¥å†µç­›é€‰ï¼Œè¯·å…ˆè¿›è¡Œæ•°æ®æ ‡æ³¨ã€‚</div>';
                // å³ä½¿æ²¡æœ‰å·¥å†µkeyï¼Œä¹ŸåŠ è½½æ‰€æœ‰æ•°æ®æ–‡ä»¶
                // å»¶è¿Ÿä¸€ä¸‹ç¡®ä¿DOMå…ƒç´ å·²å‡†å¤‡å¥½
                setTimeout(() => {
                    console.log(`ğŸ” [loadConditionKeys] å‡†å¤‡è°ƒç”¨loadAllFiles, suffix="${suffix}"`);
                    if (suffix === 'Predictor') {
                        console.log('ğŸ” å‡†å¤‡åŠ è½½Predictoræ•°æ®æ–‡ä»¶...');
                        loadAllFiles('Predictor');
                    } else if (suffix === 'Cnn1d') {
                        console.log('ğŸ” å‡†å¤‡åŠ è½½CNN 1D Autoencoderæ•°æ®æ–‡ä»¶...');
                        loadAllFiles('Cnn1d');
                    } else {
                        // LSTM Autoencoderä½¿ç”¨æ— åç¼€çš„å…ƒç´ ID
                        console.log('ğŸ” å‡†å¤‡åŠ è½½LSTM Autoencoderæ•°æ®æ–‡ä»¶...');
                        loadAllFiles(''); // ä½¿ç”¨ç©ºå­—ç¬¦ä¸²ï¼Œå› ä¸ºå…ƒç´ IDæ˜¯trainFileSelectionAreaï¼ˆæ— åç¼€ï¼‰
                    }
                }, 500);
            }
        } else {
            throw new Error(result.error || 'æœªçŸ¥é”™è¯¯');
        }
    } catch (error) {
        console.error('âŒ åŠ è½½å·¥å†µkeyå¤±è´¥:', error);
        area.innerHTML = '<div class="alert alert-danger mb-0">åŠ è½½å·¥å†µé€‰é¡¹å¤±è´¥: ' + error.message + '</div>';
    }
}

// æ¸²æŸ“å·¥å†µkeyé€‰æ‹©åŒºåŸŸ
function renderConditionKeys(keys, suffix = '') {
    const areaId = suffix ? `conditionSelectionArea${suffix}` : 'conditionSelectionArea';
    const area = document.getElementById(areaId);
    if (!area) return;
    
    let html = '<div class="row g-3">';
    
    keys.forEach(key => {
        const valuesId = suffix ? `conditionValues_${key}_${suffix}` : `conditionValues_${key}`;
        html += `
            <div class="col-md-6">
                <div class="card border">
                    <div class="card-body">
                        <h6 class="card-title">
                            <i class="fas fa-tag me-2 text-primary"></i>${key}
                        </h6>
                        <div id="${valuesId}" class="mt-2">
                            <div class="text-center py-2">
                                <button class="btn btn-sm btn-outline-primary" onclick="loadConditionValues('${key}', '${suffix}')">
                                    <i class="fas fa-chevron-down me-1"></i>å±•å¼€é€‰é¡¹
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    });
    
    html += '</div>';
    area.innerHTML = html;
}

// åŠ è½½æŒ‡å®škeyçš„valueåˆ—è¡¨
async function loadConditionValues(key, suffix = '') {
    const containerId = suffix ? `conditionValues_${key}_${suffix}` : `conditionValues_${key}`;
    const container = document.getElementById(containerId);
    if (!container) return;
    
    try {
        container.innerHTML = '<div class="text-center py-2"><div class="spinner-border spinner-border-sm text-primary"></div></div>';
        
        const response = await fetch(`/anomaly_detection/api/condition_values?key=${encodeURIComponent(key)}`);
        const result = await response.json();
        
        if (result.success && result.values && result.values.length > 0) {
            renderConditionValues(key, result.values, suffix);
        } else {
            container.innerHTML = '<div class="text-muted small">æš‚æ— é€‰é¡¹</div>';
        }
    } catch (error) {
        console.error(`åŠ è½½å·¥å†µvalueå¤±è´¥ (${key}):`, error);
        container.innerHTML = '<div class="text-danger small">åŠ è½½å¤±è´¥</div>';
    }
}

// æ¸²æŸ“å·¥å†µvalueé€‰æ‹©åŒºåŸŸ
function renderConditionValues(key, values, suffix = '') {
    const containerId = suffix ? `conditionValues_${key}_${suffix}` : `conditionValues_${key}`;
    const container = document.getElementById(containerId);
    if (!container) return;
    
    let html = '<div class="d-flex flex-wrap gap-2">';
    
    values.forEach(value => {
        const isSelected = selectedConditions[key] && selectedConditions[key].includes(value);
        const btnId = suffix ? `conditionBtn_${key}_${value}_${suffix}` : `conditionBtn_${key}_${value}`;
        html += `
            <button type="button" 
                    class="btn btn-sm ${isSelected ? 'btn-primary' : 'btn-outline-primary'}" 
                    onclick="toggleConditionValue('${key}', '${value}', '${suffix}')"
                    id="${btnId}">
                ${value}
                ${isSelected ? ' <i class="fas fa-check"></i>' : ''}
            </button>
        `;
    });
    
    html += '</div>';
    container.innerHTML = html;
}

// åˆ‡æ¢å·¥å†µvalueé€‰æ‹©
function toggleConditionValue(key, value, suffix = '') {
    if (!selectedConditions[key]) {
        selectedConditions[key] = [];
    }
    
    const index = selectedConditions[key].indexOf(value);
    if (index > -1) {
        selectedConditions[key].splice(index, 1);
    } else {
        selectedConditions[key].push(value);
    }
    
    // æ›´æ–°æŒ‰é’®æ ·å¼
    const btnId = suffix ? `conditionBtn_${key}_${value}_${suffix}` : `conditionBtn_${key}_${value}`;
    const btn = document.getElementById(btnId);
    if (btn) {
        if (selectedConditions[key].includes(value)) {
            btn.className = 'btn btn-sm btn-primary';
            btn.innerHTML = `${value} <i class="fas fa-check"></i>`;
        } else {
            btn.className = 'btn btn-sm btn-outline-primary';
            btn.innerHTML = value;
        }
    }
    
    // å¦‚æœè¯¥keyæ²¡æœ‰é€‰ä¸­ä»»ä½•valueï¼Œä»selectedConditionsä¸­ç§»é™¤
    if (selectedConditions[key].length === 0) {
        delete selectedConditions[key];
    }
    
    // é‡æ–°ç­›é€‰æ–‡ä»¶ï¼ˆå¦‚æœæœ‰é€‰æ‹©å·¥å†µï¼‰æˆ–é‡æ–°åŠ è½½æ‰€æœ‰æ–‡ä»¶ï¼ˆå¦‚æœæ²¡æœ‰é€‰æ‹©å·¥å†µï¼‰
    const hasConditions = Object.keys(selectedConditions).length > 0 && 
                          Object.values(selectedConditions).some(v => v.length > 0);
    
    if (hasConditions) {
        if (suffix === 'Predictor') {
            filterFilesPredictor();
        } else if (suffix === 'Cnn1d') {
            filterFilesCnn1d();
        } else {
            filterFiles();
        }
    } else {
        // æ²¡æœ‰é€‰æ‹©å·¥å†µï¼Œé‡æ–°åŠ è½½æ‰€æœ‰æ–‡ä»¶
        if (suffix === 'Predictor') {
            loadAllFiles('Predictor');
        } else if (suffix === 'Cnn1d') {
            loadAllFiles('Cnn1d');
        } else {
            loadAllFiles();
        }
    }
}

// ç­›é€‰æ–‡ä»¶
async function filterFiles() {
    // ç­›é€‰è®­ç»ƒé›†æ–‡ä»¶
    await filterTrainFiles();
    
    // è‡ªåŠ¨ç­›é€‰æµ‹è¯•é›†æ–‡ä»¶ï¼ˆä¸è®­ç»ƒé›†ç±»ä¼¼ï¼‰
    await filterTestFiles();
}

// LSTMé¢„æµ‹æ¨¡å‹çš„ç­›é€‰å‡½æ•°
async function filterFilesPredictor() {
    await filterTrainFilesPredictor();
    // è‡ªåŠ¨ç­›é€‰æµ‹è¯•é›†æ–‡ä»¶ï¼ˆä¸è®­ç»ƒé›†ç±»ä¼¼ï¼‰
    await filterTestFilesPredictor();
}

// CNN 1D Autoencoderçš„ç­›é€‰å‡½æ•°
async function filterFilesCnn1d() {
    await filterTrainFilesCnn1d();
    // è‡ªåŠ¨ç­›é€‰æµ‹è¯•é›†æ–‡ä»¶ï¼ˆä¸è®­ç»ƒé›†ç±»ä¼¼ï¼‰
    await filterTestFilesCnn1d();
}

// åŠ è½½æ‰€æœ‰æ•°æ®æ–‡ä»¶ï¼ˆä¸ç­›é€‰ï¼‰
async function loadAllFiles(suffix = '') {
    const areaId = suffix ? `trainFileSelectionArea${suffix}` : 'trainFileSelectionArea';
    const listId = suffix ? `trainFileList${suffix}` : 'trainFileList';
    const countId = suffix ? `trainFileCount${suffix}` : 'trainFileCount';
    const testAreaId = suffix ? `testFileSelectionArea${suffix}` : 'testFileSelectionArea';
    const testListId = suffix ? `testFileList${suffix}` : 'testFileList';
    
    const area = document.getElementById(areaId);
    const list = document.getElementById(listId);
    const countSpan = document.getElementById(countId);
    const testArea = document.getElementById(testAreaId);
    const testList = document.getElementById(testListId);
    
    console.log(`ğŸ” loadAllFiles è¢«è°ƒç”¨, suffix=${suffix}`);
    console.log(`ğŸ” æŸ¥æ‰¾å…ƒç´ : areaId=${areaId}, listId=${listId}`);
    console.log(`ğŸ” areaå…ƒç´ :`, area, `listå…ƒç´ :`, list);
    
    if (!area || !list) {
        console.error(`âŒ æœªæ‰¾åˆ°å…ƒç´ : areaId=${areaId}, listId=${listId}`);
        console.error(`âŒ areaå­˜åœ¨:`, !!area, `listå­˜åœ¨:`, !!list);
        // å°è¯•æŸ¥æ‰¾æ‰€æœ‰å¯èƒ½çš„å…ƒç´ 
        console.error(`âŒ å°è¯•æŸ¥æ‰¾æ‰€æœ‰trainFileSelectionAreaç›¸å…³å…ƒç´ :`, 
            Array.from(document.querySelectorAll('[id*="trainFileSelectionArea"]')).map(el => el.id));
        console.error(`âŒ å°è¯•æŸ¥æ‰¾æ‰€æœ‰trainFileListç›¸å…³å…ƒç´ :`, 
            Array.from(document.querySelectorAll('[id*="trainFileList"]')).map(el => el.id));
        return;
    }
    
    console.log(`âœ… æ‰¾åˆ°å…ƒç´ ï¼Œå¼€å§‹åŠ è½½æ•°æ®æ–‡ä»¶...`);
    
    // ç¡®ä¿æ–‡ä»¶é€‰æ‹©åŒºåŸŸå¯è§
    area.style.display = 'block';
    if (testArea) testArea.style.display = 'block';
    
    try {
        list.innerHTML = '<div class="text-center py-3"><div class="spinner-border spinner-border-sm text-primary"></div></div>';
        if (testList) testList.innerHTML = '<div class="text-center py-3"><div class="spinner-border spinner-border-sm text-primary"></div></div>';
        
        // å¦‚æœæ²¡æœ‰é€‰æ‹©å·¥å†µï¼Œç›´æ¥åŠ è½½æ‰€æœ‰æ–‡ä»¶
        const hasConditions = Object.keys(selectedConditions).length > 0 && 
                              Object.values(selectedConditions).some(v => v.length > 0);
        
        if (!hasConditions) {
            // åŠ è½½æ‰€æœ‰æ–‡ä»¶ï¼ˆä¸ç­›é€‰ï¼‰
            const response = await fetch('/anomaly_detection/api/processed_data');
            const result = await response.json();
            
            if (result.success) {
                console.log(`âœ… æˆåŠŸåŠ è½½ ${result.files.length} ä¸ªæ–‡ä»¶`);
                
                // ç­›é€‰å‡ºè®­ç»ƒé›†æ–‡ä»¶ï¼ˆæ ‡ç­¾ä¸º"æ­£å¸¸"ï¼‰
                trainFiles = (result.files || []).filter(f => f.label === 'æ­£å¸¸');
                // æµ‹è¯•é›†æ–‡ä»¶ï¼šåŒ…å«æ‰€æœ‰æ ‡ç­¾ä¸º"æ­£å¸¸"æˆ–"å¼‚å¸¸"çš„æ–‡ä»¶
                testFiles = (result.files || []).filter(f => f.label === 'æ­£å¸¸' || f.label === 'å¼‚å¸¸');
                
                console.log(`è®­ç»ƒé›†æ–‡ä»¶: ${trainFiles.length} ä¸ª, æµ‹è¯•é›†æ–‡ä»¶: ${testFiles.length} ä¸ª`);
                
                if (trainFiles.length > 0) {
                    let fileType = 'train';
                    if (suffix === 'Predictor') {
                        fileType = 'trainPredictor';
                    } else if (suffix === 'Cnn1d') {
                        fileType = 'trainCnn1d';
                    }
                    renderFileList(list, trainFiles, fileType);
                    area.style.display = 'block';
                    if (countSpan) countSpan.textContent = trainFiles.length;
                    console.log(`âœ… å·²æ˜¾ç¤º ${trainFiles.length} ä¸ªè®­ç»ƒæ–‡ä»¶`);
                } else {
                    list.innerHTML = '<div class="text-muted text-center py-3">æ²¡æœ‰å¯ç”¨çš„è®­ç»ƒæ–‡ä»¶ï¼ˆéœ€è¦æ ‡ç­¾ä¸º"æ­£å¸¸"çš„æ–‡ä»¶ï¼‰</div>';
                    area.style.display = 'block';
                    if (countSpan) countSpan.textContent = '0';
                    console.warn('âš ï¸ æ²¡æœ‰æ‰¾åˆ°æ ‡ç­¾ä¸º"æ­£å¸¸"çš„è®­ç»ƒæ–‡ä»¶');
                }
                
                if (testFiles.length > 0 && testList) {
                    let testFileType = 'test';
                    if (suffix === 'Predictor') {
                        testFileType = 'testPredictor';
                    } else if (suffix === 'Cnn1d') {
                        testFileType = 'testCnn1d';
                    }
                    renderFileList(testList, testFiles, testFileType);
                    if (testArea) testArea.style.display = 'block';
                    console.log(`âœ… å·²æ˜¾ç¤º ${testFiles.length} ä¸ªæµ‹è¯•æ–‡ä»¶`);
                } else if (testList) {
                    testList.innerHTML = '<div class="text-muted text-center py-3">æ²¡æœ‰å¯ç”¨çš„æµ‹è¯•æ–‡ä»¶</div>';
                    if (testArea) testArea.style.display = 'block';
                    console.warn('âš ï¸ æ²¡æœ‰æ‰¾åˆ°æµ‹è¯•æ–‡ä»¶');
                }
            } else {
                throw new Error(result.error || 'åŠ è½½å¤±è´¥');
            }
        } else {
            // æœ‰å·¥å†µé€‰æ‹©ï¼Œè¿›è¡Œç­›é€‰
            await filterTrainFiles(suffix);
            await filterTestFiles(suffix);
        }
    } catch (error) {
        console.error('åŠ è½½æ•°æ®æ–‡ä»¶å¤±è´¥:', error);
        list.innerHTML = '<div class="alert alert-danger mb-0">åŠ è½½å¤±è´¥: ' + error.message + '</div>';
    }
}

// ç­›é€‰è®­ç»ƒé›†æ–‡ä»¶
async function filterTrainFiles(suffix = '') {
    const areaId = suffix ? `trainFileSelectionArea${suffix}` : 'trainFileSelectionArea';
    const listId = suffix ? `trainFileList${suffix}` : 'trainFileList';
    const countId = suffix ? `trainFileCount${suffix}` : 'trainFileCount';
    
    const area = document.getElementById(areaId);
    const list = document.getElementById(listId);
    const countSpan = document.getElementById(countId);
    
    if (!area || !list) return;
    
    try {
        list.innerHTML = '<div class="text-center py-3"><div class="spinner-border spinner-border-sm text-primary"></div></div>';
        
        const response = await fetch('/anomaly_detection/api/filter_files', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                conditions: selectedConditions,
                file_type: 'train'
            })
        });
        
        const result = await response.json();
        
        if (result.success) {
            trainFiles = result.files || [];
            
            if (trainFiles.length > 0) {
                let fileType = 'train';
                if (suffix === 'Predictor') {
                    fileType = 'trainPredictor';
                } else if (suffix === 'Cnn1d') {
                    fileType = 'trainCnn1d';
                }
                renderFileList(list, trainFiles, fileType);
                area.style.display = 'block';
                if (countSpan) countSpan.textContent = trainFiles.length;
            } else {
                list.innerHTML = '<div class="text-muted text-center py-3">æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶</div>';
                area.style.display = 'block';
                if (countSpan) countSpan.textContent = '0';
            }
        } else {
            list.innerHTML = '<div class="alert alert-danger mb-0">ç­›é€‰å¤±è´¥: ' + (result.error || 'æœªçŸ¥é”™è¯¯') + '</div>';
        }
    } catch (error) {
        console.error('ç­›é€‰è®­ç»ƒé›†æ–‡ä»¶å¤±è´¥:', error);
        list.innerHTML = '<div class="alert alert-danger mb-0">ç­›é€‰å¤±è´¥: ' + error.message + '</div>';
    }
}

// ç­›é€‰æµ‹è¯•é›†æ–‡ä»¶
async function filterTestFiles(suffix = '') {
    const areaId = suffix ? `testFileSelectionArea${suffix}` : 'testFileSelectionArea';
    const listId = suffix ? `testFileList${suffix}` : 'testFileList';
    
    const area = document.getElementById(areaId);
    const list = document.getElementById(listId);
    
    if (!area || !list) return;
    
    try {
        list.innerHTML = '<div class="text-center py-3"><div class="spinner-border spinner-border-sm text-primary"></div></div>';
        
        const response = await fetch('/anomaly_detection/api/filter_files', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
                conditions: selectedConditions,
                file_type: 'test'
            })
        });
        
        const result = await response.json();
        
        if (result.success) {
            const files = result.files || [];
            
            if (files.length > 0) {
                let fileType = 'test';
                if (suffix === 'Predictor') {
                    fileType = 'testPredictor';
                } else if (suffix === 'Cnn1d') {
                    fileType = 'testCnn1d';
                }
                renderFileList(list, files, fileType);
                area.style.display = 'block';
            } else {
                list.innerHTML = '<div class="text-muted text-center py-3">æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„æ–‡ä»¶</div>';
                area.style.display = 'block';
            }
        } else {
            list.innerHTML = '<div class="alert alert-danger mb-0">ç­›é€‰å¤±è´¥: ' + (result.error || 'æœªçŸ¥é”™è¯¯') + '</div>';
            area.style.display = 'block';
        }
    } catch (error) {
        console.error('ç­›é€‰æµ‹è¯•é›†æ–‡ä»¶å¤±è´¥:', error);
        list.innerHTML = '<div class="alert alert-danger mb-0">ç­›é€‰å¤±è´¥: ' + error.message + '</div>';
        area.style.display = 'block';
    }
}

// æ¸²æŸ“æ–‡ä»¶åˆ—è¡¨
function renderFileList(container, files, type) {
    if (!container) return;
    
    let html = '<div class="table-responsive"><table class="table table-sm table-hover mb-0">';
    html += '<thead class="table-light"><tr>';
    html += '<th style="width: 40px;"><input type="checkbox" class="form-check-input" onchange="toggleAllFiles(this, \'' + type + '\')"></th>';
    html += '<th>æ–‡ä»¶å</th>';
    html += '<th>æ ‡ç­¾</th>';
    
    // æ·»åŠ å·¥å†µåˆ—
    const allKeys = Object.keys(selectedConditions);
    allKeys.forEach(key => {
        html += `<th>${key}</th>`;
    });
    
    html += '<th>å¤§å°</th>';
    html += '</tr></thead><tbody>';
    
    files.forEach((file, index) => {
        const conditions = file.conditions || {};
        html += '<tr>';
        html += `<td><input type="checkbox" class="form-check-input file-checkbox" data-filename="${file.filename}" data-type="${type}"></td>`;
        html += `<td><small>${file.display_name || file.filename}</small></td>`;
        html += `<td><span class="badge bg-${file.label === 'æ­£å¸¸' ? 'success' : 'danger'}">${file.label}</span></td>`;
        
        // æ·»åŠ å·¥å†µå€¼
        allKeys.forEach(key => {
            const value = conditions[key] || '';
            html += `<td><small>${value || '<span class="text-muted">-</span>'}</small></td>`;
        });
        
        html += `<td><small>${formatFileSize(file.size)}</small></td>`;
        html += '</tr>';
    });
    
    html += '</tbody></table></div>';
    container.innerHTML = html;
}

// æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
function formatFileSize(bytes) {
    if (bytes < 1024) return bytes + ' B';
    if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(2) + ' KB';
    return (bytes / (1024 * 1024)).toFixed(2) + ' MB';
}

// å…¨é€‰/å–æ¶ˆå…¨é€‰
function toggleAllFiles(checkbox, type) {
    const checkboxes = document.querySelectorAll(`.file-checkbox[data-type="${type}"]`);
    checkboxes.forEach(cb => {
        cb.checked = checkbox.checked;
    });
}

function selectAllTrainFiles() {
    const checkboxes = document.querySelectorAll('.file-checkbox[data-type="train"]');
    checkboxes.forEach(cb => cb.checked = true);
}

function deselectAllTrainFiles() {
    const checkboxes = document.querySelectorAll('.file-checkbox[data-type="train"]');
    checkboxes.forEach(cb => cb.checked = false);
}

function selectAllTrainFilesPredictor() {
    const checkboxes = document.querySelectorAll('.file-checkbox[data-type="trainPredictor"]');
    checkboxes.forEach(cb => cb.checked = true);
}

function deselectAllTrainFilesPredictor() {
    const checkboxes = document.querySelectorAll('.file-checkbox[data-type="trainPredictor"]');
    checkboxes.forEach(cb => cb.checked = false);
}

function selectAllTestFiles() {
    const checkboxes = document.querySelectorAll('.file-checkbox[data-type="test"]');
    checkboxes.forEach(cb => cb.checked = true);
}

function deselectAllTestFiles() {
    const checkboxes = document.querySelectorAll('.file-checkbox[data-type="test"]');
    checkboxes.forEach(cb => cb.checked = false);
}

function selectAllTestFilesPredictor() {
    const checkboxes = document.querySelectorAll('.file-checkbox[data-type="testPredictor"]');
    checkboxes.forEach(cb => cb.checked = true);
}

function deselectAllTestFilesPredictor() {
    const checkboxes = document.querySelectorAll('.file-checkbox[data-type="testPredictor"]');
    checkboxes.forEach(cb => cb.checked = false);
}

function selectAllTrainFilesCnn1d() {
    const checkboxes = document.querySelectorAll('.file-checkbox[data-type="trainCnn1d"]');
    checkboxes.forEach(cb => cb.checked = true);
}

function deselectAllTrainFilesCnn1d() {
    const checkboxes = document.querySelectorAll('.file-checkbox[data-type="trainCnn1d"]');
    checkboxes.forEach(cb => cb.checked = false);
}

function selectAllTestFilesCnn1d() {
    const checkboxes = document.querySelectorAll('.file-checkbox[data-type="testCnn1d"]');
    checkboxes.forEach(cb => cb.checked = true);
}

function deselectAllTestFilesCnn1d() {
    const checkboxes = document.querySelectorAll('.file-checkbox[data-type="testCnn1d"]');
    checkboxes.forEach(cb => cb.checked = false);
}

// åˆ‡æ¢æµ‹è¯•é›†é€‰æ‹©ï¼ˆå·²åºŸå¼ƒï¼Œæµ‹è¯•é›†ç°åœ¨è‡ªåŠ¨æ˜¾ç¤ºï¼‰
function toggleTestSetSelection() {
    // å·²åºŸå¼ƒï¼Œæµ‹è¯•é›†ç°åœ¨è‡ªåŠ¨æ˜¾ç¤º
}

function toggleTestSetSelectionPredictor() {
    // å·²åºŸå¼ƒï¼Œæµ‹è¯•é›†ç°åœ¨è‡ªåŠ¨æ˜¾ç¤º
}

// è·å–é€‰ä¸­çš„æ–‡ä»¶åˆ—è¡¨
function getSelectedFiles(type) {
    const checkboxes = document.querySelectorAll(`.file-checkbox[data-type="${type}"]:checked`);
    return Array.from(checkboxes).map(cb => cb.getAttribute('data-filename'));
}

// LSTMé¢„æµ‹æ¨¡å‹çš„è¾…åŠ©å‡½æ•°
async function filterTrainFilesPredictor() {
    return filterTrainFiles('Predictor');
}

async function filterTestFilesPredictor() {
    return filterTestFiles('Predictor');
}

// CNN 1D Autoencoderçš„è¾…åŠ©å‡½æ•°
async function filterTrainFilesCnn1d() {
    return filterTrainFiles('Cnn1d');
}

async function filterTestFilesCnn1d() {
    return filterTestFiles('Cnn1d');
}

// é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–
document.addEventListener('DOMContentLoaded', function() {
    console.log('ğŸš€ é¡µé¢åŠ è½½å®Œæˆï¼Œå¼€å§‹åˆå§‹åŒ–...');
    
    // åˆå§‹åŒ–é»˜è®¤çš„æ•°æ®é›†é…ç½®æ˜¾ç¤º
    const modelTypeSelect = document.getElementById('modelType');
    const defaultModelType = modelTypeSelect?.value || 'lstm_predictor';
    
    console.log('ğŸ“‹ å½“å‰é€‰æ‹©çš„æ¨¡å‹ç±»å‹:', defaultModelType);
    
    // ç›´æ¥è°ƒç”¨é…ç½®æ˜¾ç¤ºå‡½æ•°ï¼Œå®ƒä¼šå¤„ç†æ‰€æœ‰æ˜¾ç¤º/éšè—é€»è¾‘
    switchDatasetConfigDisplay(defaultModelType);
    
    // å»¶è¿ŸåŠ è½½å·¥å†µé€‰é¡¹ï¼Œç¡®ä¿DOMå…ƒç´ å·²å­˜åœ¨
    setTimeout(() => {
        console.log('â° å¼€å§‹åŠ è½½å·¥å†µé€‰é¡¹...');
        if (defaultModelType === 'lstm_predictor') {
            loadConditionKeys('Predictor');
        } else if (defaultModelType === 'lstm_autoencoder') {
            loadConditionKeys(''); // LSTM Autoencoderä½¿ç”¨æ— åç¼€çš„å…ƒç´ ID
        } else if (defaultModelType === 'cnn_1d_autoencoder') {
            loadConditionKeys('Cnn1d');
        }
    }, 500);
    
    // ç»‘å®šé˜ˆå€¼è®¡ç®—æ–¹æ³•åˆ‡æ¢äº‹ä»¶
    const thresholdMethodSelect = document.getElementById('thresholdMethod');
    if (thresholdMethodSelect) {
        thresholdMethodSelect.addEventListener('change', onThresholdMethodChange);
    }
});

// é˜ˆå€¼è®¡ç®—æ–¹æ³•åˆ‡æ¢å¤„ç†
function onThresholdMethodChange() {
    const method = document.getElementById('thresholdMethod')?.value;
    const percentileConfig = document.getElementById('thresholdPercentileConfig');
    const contaminationConfig = document.getElementById('thresholdContaminationConfig');
    
    if (method === 'percentile') {
        if (percentileConfig) percentileConfig.style.display = 'block';
        if (contaminationConfig) contaminationConfig.style.display = 'none';
    } else if (method === 'contamination') {
        if (percentileConfig) percentileConfig.style.display = 'none';
        if (contaminationConfig) contaminationConfig.style.display = 'flex';
    } else {
        // 3sigmaæ–¹æ³•ä¸éœ€è¦é¢å¤–é…ç½®
        if (percentileConfig) percentileConfig.style.display = 'none';
        if (contaminationConfig) contaminationConfig.style.display = 'none';
    }
}
</script>

<div class="text-center mt-5">
    <a href="/anomaly_detection" class="btn btn-outline-primary btn-lg px-5 py-3">
        <i class="fas fa-arrow-left me-2"></i>
        è¿”å›å¼‚å¸¸æ£€æµ‹ä¸»é¡µ
    </a>
</div>
{% endblock %}